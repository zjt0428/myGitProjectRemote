<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="terminal">
	<!-- 当前设备状态汇总 -->
	<select id="gather">
	<![CDATA[
		SELECT B.CODE BUSINESSSTATUS, COUNT(T.EQUIP_ID) COUNTS
		  FROM BM_BUILTIN_STORAGE B
		  LEFT JOIN T_EQUIPMENT T ON T.BUSINESS_STATUS = B.CODE AND T.STATUS < '6' AND T.DEL_FLAG = 1
		 WHERE 1 = 1
		 GROUP BY B.CODE
	]]>
	</select>
	<!-- 当前人员LBS -->
	<select id="list_user_lbs">
	<![CDATA[
		SELECT U.USERID userId, U.FULLNAME fullname, U.LONGITUDE longitude,
		U.LATITUDE latitude, CONVERT(CHAR(10), U.UPDATE_TIME, 23) updateTime  
		FROM APP_USER U WHERE U.STATUS = 1 AND U.DELFLAG = 0 AND U.USERID > 1 AND U.LATITUDE IS NOT NULL
	]]>
	</select>
	<!-- 待安装的设备列表 -->
	<select id="wait_install">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(128)
		DECLARE @RECORD_ID VARCHAR(128)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		SET @PROJECT_NAME = ?
		SET @RECORD_ID = ?
		SET @EXW_SERIAL = ?
		SET @BUILDING_NUM = ?
		SELECT DE.DISPATCH_EQUIP_ID dispatchEquipId,
		       DE.DISPATCH_ID       dispatchId,
		       D.PROJECT_NAME       projectName,
		       D.PROJECT_ID         projectId,
		       E.RECORD_ID          recordId,
		       E.EXW_SERIAL         exwSerial,
			   DE.BUILDING_NUM      buildingNum
		  FROM T_DISPATCH D, T_DISPATCH_EQUIP DE, T_EQUIPMENT E
		 WHERE D.APPLYFOR_STATE = '3'
		   AND D.RELATE_MODULE = 'CONTRACT_LEASE'
		   AND DE.DISPATCH_ID = D.DISPATCH_ID
		   AND DE.WORK_STATUS = '0'
		   AND DE.EQUIP_ID = E.EQUIP_ID
		   AND (
			    CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN D.PROJECT_NAME ELSE @PROJECT_NAME END), D.PROJECT_NAME) > 0
			   OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN E.RECORD_ID ELSE @RECORD_ID END), E.RECORD_ID) > 0
			   OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN D.EXW_SERIAL ELSE @EXW_SERIAL END), D.EXW_SERIAL) > 0
			   OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN DE.BUILDING_NUM ELSE @BUILDING_NUM END), DE.BUILDING_NUM) > 0
		   )
		   ORDER BY D.DISPATCH_ID desc
	]]>
	</select>
	<!-- 人员信息列表 -->
	<select id="list_practitioner">
	<![CDATA[
		DECLARE @MOBILE VARCHAR(16)
		DECLARE @PRACTI_NAME VARCHAR(64)
		DECLARE @KIND_WORK_NAME VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @MOBILE = ?
		SET @PRACTI_NAME = ?
		SET @KIND_WORK_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT P.PRACTI_ID practiId, P.MOBILE mobile, P.PRACTI_NAME practiName, B.VALUE kindWorkName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM 
			  FROM T_PRACTITIONER P
			  LEFT JOIN BM_KIND_WORK B ON B.CODE = P.KIND_WORK
			 WHERE CHARINDEX((CASE WHEN @MOBILE IS NULL THEN P.MOBILE ELSE @MOBILE END), P.MOBILE) > 0
			    OR CHARINDEX((CASE WHEN @PRACTI_NAME IS NULL THEN P.PRACTI_NAME ELSE @PRACTI_NAME END), P.PRACTI_NAME) > 0
			    OR CHARINDEX((CASE WHEN @KIND_WORK_NAME IS NULL THEN B.VALUE ELSE @KIND_WORK_NAME END), B.VALUE) > 0
	    ) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 配件信息列表 -->
	<select id="list_component">
	<![CDATA[
		DECLARE @COMPON_SERIAL VARCHAR(64)
		DECLARE @DIMENSIONS VARCHAR(64)
		DECLARE @COMPON_GENERIC_NAME VARCHAR(64)
		DECLARE @COMPON_SPECIFIC_NAME VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE @STORE_ID BIGINT
		SET @COMPON_SERIAL = ?
		SET @DIMENSIONS = ?
		SET @COMPON_GENERIC_NAME = ?
		SET @COMPON_SPECIFIC_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT C.COMPON_ID componId  ,CSS.EXW_SERIAL exwSerial, C.COMPON_SERIAL componSerial, C.CONSUME_COUNTS consumeCounts, C.DIMENSIONS dimensions, CG.VALUE componGenericName, CS.VALUE componSpecificName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			  FROM T_COMPONENT C
			  LEFT JOIN BM_COMPONENT_GENERIC CG ON CG.CODE = C.COMPON_GENERIC
			  LEFT JOIN BM_COMPONENT_SPECIFIC CS ON CS.CODE = C.COMPON_SPECIFIC
			  LEFT JOIN T_EQUIPMENT CSS ON CSS.EQUIP_ID=C.EQUIP_ID
			  WHERE (CHARINDEX((CASE WHEN @COMPON_SERIAL IS NULL THEN C.COMPON_SERIAL ELSE @COMPON_SERIAL END), C.COMPON_SERIAL) > 0
			     OR CHARINDEX((CASE WHEN @DIMENSIONS IS NULL THEN C.DIMENSIONS ELSE @DIMENSIONS END), C.DIMENSIONS) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_GENERIC_NAME IS NULL THEN CG.VALUE ELSE @COMPON_GENERIC_NAME END), CG.VALUE) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_SPECIFIC_NAME IS NULL THEN CS.VALUE ELSE @COMPON_SPECIFIC_NAME END), CS.VALUE) > 0)
			     AND C.DEL_FLAG = '1'
		) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 配件信息列表 -->
	<select id="list_component2">
	<![CDATA[
		DECLARE @COMPON_SERIAL VARCHAR(64)
		DECLARE @DIMENSIONS VARCHAR(64)
		DECLARE @COMPON_GENERIC_NAME VARCHAR(64)
		DECLARE @COMPON_SPECIFIC_NAME VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE @STORE_ID BIGINT
		DECLARE @COMPON_IDS VARCHAR(64)
		SET @COMPON_SERIAL = ?
		SET @DIMENSIONS = ?
		SET @COMPON_GENERIC_NAME = ?
		SET @COMPON_SPECIFIC_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		SET @COMPON_IDS = ?
		;WITH QUERY AS (
			SELECT C.COMPON_ID componId  ,CSS.EXW_SERIAL exwSerial, C.COMPON_SERIAL componSerial, C.CONSUME_COUNTS consumeCounts, C.DIMENSIONS dimensions, CG.VALUE componGenericName, CS.VALUE componSpecificName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			  FROM T_COMPONENT C
			  LEFT JOIN BM_COMPONENT_GENERIC CG ON CG.CODE = C.COMPON_GENERIC
			  LEFT JOIN BM_COMPONENT_SPECIFIC CS ON CS.CODE = C.COMPON_SPECIFIC
			  LEFT JOIN T_EQUIPMENT CSS ON CSS.EQUIP_ID=C.EQUIP_ID
			  WHERE (CHARINDEX((CASE WHEN @COMPON_SERIAL IS NULL THEN C.COMPON_SERIAL ELSE @COMPON_SERIAL END), C.COMPON_SERIAL) > 0
			     OR CHARINDEX((CASE WHEN @DIMENSIONS IS NULL THEN C.DIMENSIONS ELSE @DIMENSIONS END), C.DIMENSIONS) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_GENERIC_NAME IS NULL THEN CG.VALUE ELSE @COMPON_GENERIC_NAME END), CG.VALUE) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_SPECIFIC_NAME IS NULL THEN CS.VALUE ELSE @COMPON_SPECIFIC_NAME END), CS.VALUE) > 0)
			     AND C.DEL_FLAG = '1'
			     AND charindex(','+ltrim(C.COMPON_ID),','+@COMPON_IDS)>0
		) SELECT * FROM QUERY WHERE _ROWNUM > @START-1 AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	
	<!-- 配件信息列表 -->
	<select id="list_component_dispatch">
		<![CDATA[
		DECLARE @COMPON_SERIAL VARCHAR(64)
		DECLARE @DIMENSIONS VARCHAR(64)
		DECLARE @COMPON_GENERIC_NAME VARCHAR(64)
		DECLARE @COMPON_SPECIFIC_NAME VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE @STORE_ID BIGINT
		SET @COMPON_SERIAL = ?
		SET @DIMENSIONS = ?
		SET @COMPON_GENERIC_NAME = ?
		SET @COMPON_SPECIFIC_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		SET @STORE_ID = ?
		SET @EXW_SERIAL=?

		;WITH QUERY AS (
			SELECT C.COMPON_ID componId  ,CSS.EXW_SERIAL exwSerial, C.COMPON_SERIAL componSerial, C.CONSUME_COUNTS consumeCounts, C.DIMENSIONS dimensions, CG.VALUE componGenericName, CS.VALUE componSpecificName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM T_COMPONENT C
			  LEFT JOIN BM_COMPONENT_GENERIC CG ON CG.CODE = C.COMPON_GENERIC
			  LEFT JOIN BM_COMPONENT_SPECIFIC CS ON CS.CODE = C.COMPON_SPECIFIC
			    LEFT JOIN T_EQUIPMENT CSS ON CSS.EQUIP_ID=C.EQUIP_ID
			WHERE (CHARINDEX((CASE WHEN @COMPON_SERIAL IS NULL THEN C.COMPON_SERIAL ELSE @COMPON_SERIAL END), C.COMPON_SERIAL) > 0
				   OR CHARINDEX((CASE WHEN @DIMENSIONS IS NULL THEN C.DIMENSIONS ELSE @DIMENSIONS END), C.DIMENSIONS) > 0
				    OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN CSS.EXW_SERIAL ELSE @EXW_SERIAL END), CSS.EXW_SERIAL) > 0
				   OR CHARINDEX((CASE WHEN @COMPON_GENERIC_NAME IS NULL THEN CG.VALUE ELSE @COMPON_GENERIC_NAME END), CG.VALUE) > 0
				   OR CHARINDEX((CASE WHEN @COMPON_SPECIFIC_NAME IS NULL THEN CS.VALUE ELSE @COMPON_SPECIFIC_NAME END), CS.VALUE) > 0)
				  AND C.DEL_FLAG = '1'
				  AND (@STORE_ID IS NULL OR @STORE_ID = '' OR C.STORE_ID = @STORE_ID)
				  AND C.CONSUME_COUNTS <> 0
		) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 获取设备列表 -->
	<select id="list_equip">
		<![CDATA[
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(64)
		DECLARE @EQUIP_VENDER VARCHAR(64)
		DECLARE @EQUIP_GENERIC_NAME VARCHAR(64)
		DECLARE @EQUIP_SPECIFIC_NAME VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @EXW_SERIAL = ?
		SET @RECORD_ID = ?
		SET @EQUIP_VENDER = ?
		SET @EQUIP_GENERIC_NAME =?
		SET @EQUIP_SPECIFIC_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT E.EQUIP_ID equipId  , E.EXW_SERIAL exwSerial, E.RECORD_ID recordId, E.EQUIP_VENDER equipVender, EG.VALUE equipGenericName, ES.VALUE equipSpecificName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			  FROM T_EQUIPMENT E
			  LEFT JOIN BM_EQUIP_GENERIC EG ON EG.CODE = E.EQUIP_GENERIC
			  LEFT JOIN BM_EQUIP_SPECIFIC ES ON ES.CODE = E.EQUIP_SPECIFIC
			  WHERE (CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN E.EXW_SERIAL ELSE @EXW_SERIAL END), E.EXW_SERIAL) > 0
			     OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN E.RECORD_ID ELSE @RECORD_ID END), E.RECORD_ID) > 0
				 OR CHARINDEX((CASE WHEN @EQUIP_VENDER IS NULL THEN E.EQUIP_VENDER ELSE @EQUIP_VENDER END), E.EQUIP_VENDER) > 0
			     OR CHARINDEX((CASE WHEN @EQUIP_GENERIC_NAME IS NULL THEN EG.VALUE ELSE @EQUIP_GENERIC_NAME END), EG.VALUE) > 0
			     OR CHARINDEX((CASE WHEN @EQUIP_SPECIFIC_NAME IS NULL THEN ES.VALUE ELSE @EQUIP_SPECIFIC_NAME END), ES.VALUE) > 0)
			     AND E.DEL_FLAG = '1'
		) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 安装信息列表 -->
	<select id="list_install_all">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		DECLARE @FLOW_STATE VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @PROJECT_NAME = ?
		SET @RECORD_ID = ?
		SET @EXW_SERIAL = ?
		SET @BUILDING_NUM = ?
		SET @FLOW_STATE = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT *, ROW_NUMBER() OVER (ORDER BY A.startinDate DESC) AS _ROWNUM
			  FROM (SELECT EI.INSTALL_ID        installId,
			               ED.PROJECT_NAME      projectName,
			               ED.RECORD_ID         recordId,
			               ED.EXW_SERIAL        exwserial,
			               ED.BUILDING_NUM      buildingnum,
			               CONVERT(varchar(10), EI.STARTIN_DATE, 23)      startinDate,
			               CONVERT(varchar(10), EI.ENDIN_DATE, 23)        endinDate,
			               EI.WALL_ATTACHE_QTY  wallAttacheQty,
			               EI.INSTALL_HEIGHT    installHeight,
			               EI.BRACHIUM          brachium,
			               EI.LONGITUDE         longitude,
			               EI.LATITUDE          latitude,
			               EI.USER_NAME         userName,
			               EF.DISPATCH_ID       dispatchId,
			               EF.FLOW_ID           flowId,
			               'EQUIP_INSTALL'      relateModule
			          FROM T_EQUIPMENT_INSTALL EI,
			               T_EQUIPMENT_FLOW    EF,
			               T_EQUIPMENT_DIARY   ED
			         WHERE EI.FLOW_ID = EF.FLOW_ID
			           AND EF.FLOW_ID = ED.FLOW_ID
			           AND EI.DEL_FLAG = 1
					   AND EF.FLOW_STATE = @FLOW_STATE
			           AND (CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN ED.PROJECT_NAME ELSE @PROJECT_NAME END), ED.PROJECT_NAME) > 0
			           			 OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN ED.RECORD_ID ELSE @RECORD_ID END), ED.RECORD_ID) > 0
			           			 OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN ED.EXW_SERIAL ELSE @EXW_SERIAL END), ED.EXW_SERIAL) > 0
			           			 OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN ED.BUILDING_NUM ELSE @BUILDING_NUM END), ED.BUILDING_NUM) > 0
			           	   )
			        ) A
		) SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY installId desc
	]]>
	</select>
	<!-- 待拆卸列表 -->
	<select id="list_dismantle_wait">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @PROJECT_NAME = ?
		SET @RECORD_ID = ?
		SET @EXW_SERIAL = ?
		SET @BUILDING_NUM = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT *, ROW_NUMBER() OVER (ORDER BY A.startinDate DESC) AS _ROWNUM 
			  FROM (SELECT EI.INSTALL_ID        installId,
			               ED.PROJECT_NAME      projectName,
			               ED.RECORD_ID         recordId,
			               ED.EXW_SERIAL        exwserial,
	                       ED.BUILDING_NUM      buildingnum,
			               CONVERT(varchar(10), EI.STARTIN_DATE, 23)      startinDate,
			               CONVERT(varchar(10), EI.ENDIN_DATE, 23)        endinDate,
			               EI.WALL_ATTACHE_QTY  wallAttacheQty,
			               EI.INSTALL_HEIGHT    installHeight,
			               EI.BRACHIUM          brachium,
			               EI.LONGITUDE         longitude,
			               EI.LATITUDE          latitude,
			               EI.USER_NAME         userName,
			               EF.DISPATCH_ID       dispatchId,
			               EF.FLOW_ID           flowId,
			               'EQUIP_INSTALL'      relateModule
			          FROM T_EQUIPMENT_INSTALL EI,
			               T_EQUIPMENT_FLOW    EF,
			               T_EQUIPMENT_DIARY   ED
			         WHERE EI.FLOW_ID = EF.FLOW_ID
			           AND EF.FLOW_ID = ED.FLOW_ID
			           AND (EF.FLOW_STATE = '2' OR EF.FLOW_STATE = '4')
			           AND (CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN ED.PROJECT_NAME ELSE @PROJECT_NAME END), ED.PROJECT_NAME) > 0 
			           		OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN ED.RECORD_ID ELSE @RECORD_ID END), ED.RECORD_ID) > 0
			           		OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN ED.EXW_SERIAL ELSE @EXW_SERIAL END), ED.EXW_SERIAL) > 0
			           		OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN ED.BUILDING_NUM ELSE @BUILDING_NUM END), ED.BUILDING_NUM) > 0
			           )
			        ) A
		) SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY installId desc
	]]>
	</select>
	<!-- 巡检信息列表 -->
	<select id="list_inspect_all">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(24)
	    DECLARE @START INT
	    DECLARE @PAGE_SIZE INT
		DECLARE @RECTIFICATION VARCHAR(24)
		DECLARE @INSPECT_RESULT VARCHAR(24)
		DECLARE @dataPermission VARCHAR(300)

	    SET @PROJECT_NAME = ?
   	    SET @EXW_SERIAL = ?
   	    SET @BUILDING_NUM = ?
   	    SET @RECORD_ID = ?
	    SET @START = ?
	    SET @PAGE_SIZE = ?
		SET @RECTIFICATION = ?
		SET @INSPECT_RESULT =?
		SET @dataPermission =?

	    ;WITH QUERY AS (
	      SELECT
			CONVERT(CHAR(10),A.inspectDate,23) inspectDate,inspectId,inspectPepoles,inspectResult,exwserial,buildingnum,recordId,
			inspectResultName,statusName,remark,longitude,latitude,projectName,rectification,relateModule
			, ROW_NUMBER() OVER (ORDER BY A.inspectDate DESC) AS _ROWNUM
	        FROM (SELECT EI.INSPECT_DATE     inspectDate,
	                     EI.INSPECT_ID        inspectId,
	                     EI.INSPECT_SERIAL    inspectSerial,
	                     EI.INSPECT_PEPOLES   inspectPepoles,
	                     EI.INSPECT_RESULT    inspectResult,
	                     EI.EXW_SERIAL        exwserial,
	                     EI.BUILDING_NUM      buildingnum,
	                     EI.RECORD_ID         recordId,
	                     B.VALUE              inspectResultName,
	                     EI.STATUS            statusName,
	                     EI.REMARK            remark,
	                     EI.LONGITUDE         longitude,
	                     EI.LATITUDE          latitude,
	                     ED.PROJECT_NAME      projectName,
						 EI.RECTIFICATION     rectification,
	                     'EQUIP_INSPECT'      relateModule
	                FROM T_EQUIPMENT_INSPECT EI LEFT JOIN BM_INSPECT_RESULT B ON B.CODE = EI.INSPECT_RESULT, T_EQUIPMENT_INSPECT_SCHEMA EIS, T_EQUIPMENT_DIARY ED
	                ,T_EQUIPMENT E
	               WHERE ED.EQUIP_DIARY_ID = EIS.EQUIP_DIARY_ID
	                 AND EIS.INSPECT_SCHEMA_ID = EI.INSPECT_SCHEMA_ID
	                 AND E.EQUIP_ID=ED.EQUIP_ID
	                 AND  (CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN ED.PROJECT_NAME ELSE @PROJECT_NAME END), ED.PROJECT_NAME) > 0
												OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN EI.EXW_SERIAL ELSE @EXW_SERIAL END), EI.EXW_SERIAL) > 0
												OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN EI.BUILDING_NUM ELSE @BUILDING_NUM END), EI.BUILDING_NUM) > 0
												OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN EI.RECORD_ID ELSE @RECORD_ID END), EI.RECORD_ID) > 0 )
					 AND ( EI.RECTIFICATION ='1' OR ( EI.RECTIFICATION !='2' AND CHARINDEX(EI.INSPECT_RESULT,(CASE WHEN @INSPECT_RESULT IS NULL THEN EI.INSPECT_RESULT ELSE @INSPECT_RESULT END)) > 0) )
					 AND (SELECT dbo.PermissionFilter(E.PERMISSION_FLAG, @dataPermission))=1
				

	              ) A
	    ) SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY inspectDate desc
	]]>
	</select>
	<!-- 巡检信息列表 -->
	<select id="list_inspect_all2">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(24)
	    DECLARE @START INT
	    DECLARE @PAGE_SIZE INT
		DECLARE @RECTIFICATION VARCHAR(24)
		DECLARE @INSPECT_RESULT VARCHAR(24)
		DECLARE @dataPermission VARCHAR(300)

	    SET @PROJECT_NAME = ?
   	    SET @EXW_SERIAL = ?
   	    SET @BUILDING_NUM = ?
   	    SET @RECORD_ID = ?
	    SET @START = ?
	    SET @PAGE_SIZE = ?
		SET @RECTIFICATION = ?
		SET @INSPECT_RESULT =?
		SET @dataPermission =?

	    ;WITH QUERY AS (
	      SELECT
			CONVERT(CHAR(10),A.inspectDate,23) inspectDate,inspectId,inspectPepoles,inspectResult,exwserial,buildingnum,recordId,
			inspectResultName,statusName,remark,longitude,latitude,projectName,rectification,relateModule
			, ROW_NUMBER() OVER (ORDER BY A.inspectDate DESC) AS _ROWNUM
	        FROM (SELECT EI.INSPECT_DATE     inspectDate,
	                     EI.INSPECT_ID        inspectId,
	                     EI.INSPECT_SERIAL    inspectSerial,
	                     EI.INSPECT_PEPOLES   inspectPepoles,
	                     EI.INSPECT_RESULT    inspectResult,
	                     EI.EXW_SERIAL        exwserial,
	                     EI.BUILDING_NUM      buildingnum,
	                     EI.RECORD_ID         recordId,
	                     B.VALUE              inspectResultName,
	                     EI.STATUS            statusName,
	                     EI.REMARK            remark,
	                     EI.LONGITUDE         longitude,
	                     EI.LATITUDE          latitude,
	                     ED.PROJECT_NAME      projectName,
						 EI.RECTIFICATION     rectification,
	                     'EQUIP_INSPECT'      relateModule
	                FROM T_EQUIPMENT_INSPECT EI LEFT JOIN BM_INSPECT_RESULT B ON B.CODE = EI.INSPECT_RESULT, T_EQUIPMENT_INSPECT_SCHEMA EIS, T_EQUIPMENT_DIARY ED
	                 ,T_EQUIPMENT E
	               WHERE ED.EQUIP_DIARY_ID = EIS.EQUIP_DIARY_ID
	                 AND EIS.INSPECT_SCHEMA_ID = EI.INSPECT_SCHEMA_ID
	                 AND E.EQUIP_ID=ED.EQUIP_ID
	                 AND  (CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN ED.PROJECT_NAME ELSE @PROJECT_NAME END), ED.PROJECT_NAME) > 0
												OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN EI.EXW_SERIAL ELSE @EXW_SERIAL END), EI.EXW_SERIAL) > 0
												OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN EI.BUILDING_NUM ELSE @BUILDING_NUM END), EI.BUILDING_NUM) > 0
												OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN EI.RECORD_ID ELSE @RECORD_ID END), EI.RECORD_ID) > 0 )
					 AND ( (EI.RECTIFICATION !='1' ) AND CHARINDEX(EI.INSPECT_RESULT,(CASE WHEN @INSPECT_RESULT IS NULL THEN EI.INSPECT_RESULT ELSE @INSPECT_RESULT END)) > 0)
				  	AND (SELECT dbo.PermissionFilter(E.PERMISSION_FLAG, @dataPermission))=1
				

	              ) A
	    ) SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY inspectDate desc
	]]>
	</select>
	<!-- 拆卸信息列表 -->
	<select id="list_dismantle_all">
	<![CDATA[
		DECLARE @PROJECT_NAME VARCHAR(64)
		DECLARE @RECORD_ID VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @BUILDING_NUM VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @PROJECT_NAME = ?
		SET @RECORD_ID = ?
		SET @EXW_SERIAL = ?
		SET @BUILDING_NUM = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
	      SELECT *, ROW_NUMBER() OVER (ORDER BY A.startdisDate DESC) AS _ROWNUM 
	        FROM (SELECT DIS.DISMANTLE_ID     dismantleId,
	                     ED.PROJECT_NAME      projectName,
	                     ED.RECORD_ID         recordId,
	                     ED.EXW_SERIAL        exwserial,
			             ED.BUILDING_NUM      buildingnum,
	                     CONVERT(varchar(10), DIS.STARTDIS_DATE, 23)    startdisDate,
	                     CONVERT(varchar(10), DIS.ENDDIS_DATE, 23)      enddisDate,
	                     DIS.DISMANTLE_HEIGHT dismantleHeight,
	                     DIS.LONGITUDE        longitude,
	                     DIS.LATITUDE         latitude,
	                     DIS.USER_NAME        userName,
	                     EF.DISPATCH_ID       dispatchId,
	                     'EQUIP_DISMANTLE'    relateModule
	                FROM T_EQUIPMENT_DISMANTLE DIS,
	                     T_EQUIPMENT_FLOW      EF,
	                     T_EQUIPMENT_DIARY     ED
	               WHERE DIS.FLOW_ID = EF.FLOW_ID
	                 AND EF.FLOW_ID = ED.FLOW_ID
	                 AND (     CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN ED.PROJECT_NAME ELSE @PROJECT_NAME END), ED.PROJECT_NAME) > 0 
	                 		OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN ED.RECORD_ID ELSE @RECORD_ID END), ED.RECORD_ID) > 0 
	                 		OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN ED.EXW_SERIAL ELSE @EXW_SERIAL END), ED.EXW_SERIAL) > 0 
							OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN ED.BUILDING_NUM ELSE @BUILDING_NUM END), ED.BUILDING_NUM) > 0 
	                 		)
	              UNION ALL
	              SELECT DM.DISMANTLE_ID      dismantleId,
	                     DM.PROJECT_NAME      projectName,
	                     DM.RECORD_ID         recordId,
	                     DM.EXW_SERIAL		  exwserial,
			             DM.BUILDING_NUM	  buildingnum,
	                     CONVERT(varchar(10), DM.STARTDIS_DATE, 23)     startdisDate,
	                     CONVERT(varchar(10), DM.ENDDIS_DATE, 23)       enddisDate,
	                     DM.DISMANTLE_HEIGHT  dismantleHeight,
	                     DM.LONGITUDE         longitude,
	                     DM.LATITUDE          latitude,
	                     DM.USER_NAME         userName,
	                     NULL                 dispatchId,
	                     'DISMANTLE_MANAGE'   relateModule
	                FROM T_DISMANTLE_MANAGE DM
	               WHERE CHARINDEX((CASE WHEN @PROJECT_NAME IS NULL THEN DM.PROJECT_NAME ELSE @PROJECT_NAME END), DM.PROJECT_NAME) > 0 
	                  OR CHARINDEX((CASE WHEN @RECORD_ID IS NULL THEN DM.RECORD_ID ELSE @RECORD_ID END), DM.RECORD_ID) > 0 
	                  OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN DM.EXW_SERIAL ELSE @EXW_SERIAL END), DM.EXW_SERIAL) > 0 
					  OR CHARINDEX((CASE WHEN @BUILDING_NUM IS NULL THEN DM.BUILDING_NUM ELSE @BUILDING_NUM END), DM.BUILDING_NUM) > 0 
	              ) A
	    ) SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY dismantleId desc
	]]>
	</select>
	<select id="list_chk_man">
	<![CDATA[
		SELECT U.USERID, U.FULLNAME AS USERNAME FROM APP_USER U,USER_ROLE R WHERE U.USERID=R.USERID AND STATUS=1 AND U.DELFLAG=0 
			AND U.FULLNAME LIKE ? AND R.ROLEID=? ORDER BY U.USERID
	]]>	
	</select>
	<select id="list_project">
	<![CDATA[
		SELECT P.PROJECT_ID,P.PROJECT_SERIAL,P.PROJECT_NAME,P.ADDRESS FROM T_PROJECT P WHERE P.DEL_FLAG=1
				AND P.PROJECT_NAME LIKE ? ORDER BY P.PROJECT_ID
	]]>	
	</select>
	<select id="list_inuse_project">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
         DECLARE @STATUS  VARCHAR(64)
        SET @START = ?
        SET @PAGE_SIZE =?
        SET @STATUS = ?
        ;WITH QUERY AS (
		SELECT COUNT(_EQUIP.EQUIP_ID) AS coutequip, P.PROJECT_ID AS projectId, P.PROJECT_SERIAL AS projectSerial, P.PROJECT_NAME AS projectName, P.ADDRESS AS address,bc.longitude,bc.latitude
		, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM  T_EQUIPMENT _EQUIP, T_PROJECT P,BM_COUNTY bc
			Where _EQUIP.PROJECT_ID = P.PROJECT_ID
			AND P.DEL_FLAG = 1
			AND P.STATUS=3
			AND bc.CODE=P.COUNTY
			 GROUP BY P.PROJECT_ID, P.PROJECT_SERIAL, P.PROJECT_NAME, P.ADDRESS,bc.longitude,bc.latitude) 
			SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>	
	</select>
	<select id="list_inuse_project2">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
         DECLARE @STATUS  VARCHAR(64)
        SET @START = ?
        SET @PAGE_SIZE =?
        SET @STATUS = ?
        ;WITH QUERY AS (
		SELECT COUNT(_EQUIP.EQUIP_ID) AS coutequip, P.PROJECT_ID AS projectId, P.PROJECT_SERIAL AS projectSerial, P.PROJECT_NAME AS projectName, P.ADDRESS AS address,bc.longitude,bc.latitude
		, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM  T_EQUIPMENT _EQUIP, T_PROJECT P,BM_COUNTY bc
			Where _EQUIP.PROJECT_ID = P.PROJECT_ID
			AND P.DEL_FLAG = 1
			AND _EQUIP.DEL_FLAG = 1
			AND _EQUIP.STATUS = 0
			AND _EQUIP.STORE_STATUS <>5
			AND (_EQUIP.BUSINESS_STATUS BETWEEN 3 AND 6)
			AND bc.CODE=P.COUNTY
			 GROUP BY P.PROJECT_ID, P.PROJECT_SERIAL, P.PROJECT_NAME, P.ADDRESS,bc.longitude,bc.latitude) 
			SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>	
	</select>
<!-- 	<select id="list_inuse_project">  by_dispatch
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
         DECLARE @STATUS  VARCHAR(64)
        SET @START = ?
        SET @PAGE_SIZE =?
        SET @STATUS = ?
        ;WITH QUERY AS (
		SELECT COUNT(_DE.EQUIP_ID) AS coutequip, P.PROJECT_ID AS projectId, P.PROJECT_SERIAL AS projectSerial, P.PROJECT_NAME AS projectName, P.ADDRESS AS address
		, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM  T_EQUIPMENT _EQUIP
			FULL JOIN T_DISPATCH_EQUIP _DE ON _DE.EQUIP_ID = _EQUIP.EQUIP_ID
			FULL JOIN T_DISPATCH _DISPATCH ON _DISPATCH.DISPATCH_ID = _DE.DISPATCH_ID 
			FULL JOIN T_PROJECT P ON _DISPATCH.PROJECT_ID = P.PROJECT_ID
			WHERE P.DEL_FLAG = 1
			AND P.STATUS = @STATUS
			 GROUP BY P.PROJECT_ID, P.PROJECT_SERIAL, P.PROJECT_NAME, P.ADDRESS) 
			SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>	
	</select> -->
	<select id="list_users">
	<![CDATA[
		SELECT U.USERID, U.FULLNAME AS USERNAME,U.MOBILE ,D.DEP_NAME DEPNAME
		FROM APP_USER U
		LEFT JOIN DEPARTMENT D ON U.DEP_ID = D.DEP_ID
		WHERE U.DELFLAG=0 and STATUS=1
		AND (U.FULLNAME LIKE ? or D.DEP_NAME LIKE ?)
		ORDER BY U.USERID
	]]>
	</select>
	<select id="list_usersForConstruct">
		<![CDATA[
		SELECT U.USERID, U.FULLNAME AS USERNAME,U.MOBILE
		FROM APP_USER U
		WHERE U.DELFLAG=0 and STATUS=1
		AND U.FULLNAME LIKE ?
		ORDER BY U.USERID
	]]>
	</select>
	<select id="list_types">
	<![CDATA[
		SELECT *,1 enable FROM T_APP_REPAIR_TYPE where PARENTID=? ORDER BY ID
		]]>	
	</select>

	<select id="list_app_repair">
		<![CDATA[
		SELECT R.*,(SELECT FULLNAME FROM APP_USER WHERE USERID=R.CREATE_BY) AS CREATE_BYNAME,CASE R.STATE WHEN '1' THEN '待处理' WHEN '2' THEN '派工中' 	WHEN '3' THEN '处理中' WHEN '4' THEN '完成' WHEN '0' THEN '结案' END AS STATENAME  
		FROM T_APP_REPAIR R 
		WHERE R.STATE=?  AND (R.CREATE_BY =? OR PROC_MAN LIKE ? ) AND (R.PROJ_NAME LIKE ? OR R.RECORD_SERIAL LIKE ?  OR R.EXW_SERIAL LIKE ? OR R.BUILDING_NUM LIKE ? OR R.EQUIP_ID= ?) ORDER BY R.REPID DESC
		]]>			
	</select>

	<!-- 开工项目-设备-维修信息 -->
	<select id="list_equip_repair">
		<![CDATA[
		SELECT R.*,(SELECT FULLNAME FROM APP_USER WHERE USERID=R.CREATE_BY) AS CREATE_BYNAME,CASE R.STATE WHEN '1' THEN '待处理' WHEN '2' THEN '派工中' 	WHEN '3' THEN '处理中' WHEN '4' THEN '完成' WHEN '0' THEN '结案' END AS STATENAME  
		FROM T_APP_REPAIR R 
		WHERE   R.CREATE_BY =?  AND  R.EQUIP_ID=? ORDER BY R.REPID DESC		]]>			
	</select>
		<select id="list_app_repair_admin">
		<![CDATA[
		DECLARE @projState VARCHAR(1)
		DECLARE @userId VARCHAR(32)
		DECLARE @projName VARCHAR(128)
		DECLARE @recordSerial VARCHAR(128)
		DECLARE @exwSerial VARCHAR(128)
		DECLARE @buildNum VARCHAR(128)
		DECLARE @equipId BIGINT
				SET @projState=?
				SET @userId=?
				SET @projName=?
				SET @recordSerial=?
				SET @exwSerial=?
				SET @buildNum=?
				SET @equipId=?
		SELECT
			R.*, ( SELECT FULLNAME FROM APP_USER WHERE USERID = R.CREATE_BY ) AS CREATE_BYNAME,
		CASE R.STATE 
				WHEN '1' THEN '待处理' 
				WHEN '2' THEN '派工中' 
				WHEN '3' THEN '处理中' 
				WHEN '4' THEN '完成' 
				WHEN '0' THEN '结案' 
			END AS STATENAME 
		FROM T_APP_REPAIR R 
		WHERE R.STATE=@projState
			AND (
				R.PROJ_NAME LIKE @projName
				OR R.RECORD_SERIAL LIKE @recordSerial
				OR R.EXW_SERIAL LIKE @exwSerial
				OR R.BUILDING_NUM LIKE @buildNum 
				OR R.EQUIP_ID= @equipId
			) 
			AND (@projState <>2 OR CREATE_BY=CONVERT(BIGINT,@userId) OR CHARINDEX(@userId, DIS_MAN )>0) 
		ORDER BY R.REPID DESC
		]]>			
	</select>
		<select id="count_app_repair">
		<![CDATA[
		SELECT COUNT(*) as NUM,STATE
		FROM T_APP_REPAIR R 
		WHERE (R.PROJ_NAME LIKE ? OR R.RECORD_ID LIKE ?  OR R.EXW_SERIAL LIKE ? OR R.BUILDING_NUM LIKE ? ) GROUP BY R.STATE
		]]>			
	</select>
	<select id="list_app_equips">
		<![CDATA[
		SELECT * FROM (
			SELECT  ROW_NUMBER() OVER (ORDER BY R.EQUIP_ID) AS _ROWNUM ,R.EQUIP_GENERIC,R.EQUIP_SERIAL,R.PROJECT_ID,R.EQUIP_ID ,R.EXW_SERIAL,R.BUILDING_NUM,R.PROJECT_NAME,R.RECORD_ID,(SELECT VALUE FROM BM_EQUIP_SPECIFIC WHERE CODE = R.EQUIP_SPECIFIC) as SPECIFICNAME  
			FROM T_EQUIPMENT R WHERE R.STATUS IN(0,1,2,4,6,7,9) AND (R.PROJECT_NAME LIKE ? OR R.EXW_SERIAL LIKE ? OR R.RECORD_ID like ?) AND R.DEL_FLAG = 1) A WHERE  A._ROWNUM>= ? AND A._ROWNUM <= ?
		]]>			
	</select>
	<select id="get_app_equipnums">
		<![CDATA[
		SELECT  count(*) AS _ROWNUM FROM T_EQUIPMENT R WHERE R.STATUS IN(0,1,2) AND (R.PROJECT_NAME LIKE ? OR R.EXW_SERIAL LIKE ? OR R.RECORD_ID like ?) AND R.DEL_FLAG = 1
		]]>			
	</select>
	<select id="review_count">
	<![CDATA[
		SELECT COUNT(*) AS NUM,SCORE FROM T_REVIEW WHERE  RELATE_ID=? AND RELATE_MODULE=? GROUP BY SCORE	
			]]>	
	</select>
	<select id="get_currentAppPracti">
	<![CDATA[
		SELECT * FROM T_PRACTITIONER P
		LEFT JOIN T_CORP_INFO CI ON P.CORP_ID = CI.CORP_ID
		WHERE P.USERID = ?	
			]]>
	</select>
	<select id="get_currentAppUser">
	<![CDATA[
		SELECT * FROM APP_USER P
		WHERE P.USERID = ?
			]]>
	</select>
		<select id="get_currentAntiFallAppUser">
	<![CDATA[
		SELECT * FROM T_CORP_INFO P
		WHERE P.CORP_ID = ?	
			]]>	
	</select>
	
		<select id="get_toSendUser">
	<![CDATA[
	 select * from T_CORP_INFO where CORP_ID=(
		select PB_ENT from T_CONTRACT_LEASE where contract_ID=( select RELATE_ID from T_DISPATCH where DISPATCH_ID=?));
			]]>	
	</select>
	
	<select id="get_toSendUserFromContratArrange">
	<![CDATA[
	 select * from T_CORP_INFO where CORP_ID=?;
			]]>	
	</select>
    <!-- 项目配件信息列表 -->
    <select id="list_project_compon">
        <![CDATA[
		DECLARE @COMPON_SERIAL VARCHAR(64)
		DECLARE @DIMENSIONS VARCHAR(64)
		DECLARE @COMPON_GENERIC_NAME VARCHAR(64)
		DECLARE @COMPON_SPECIFIC_NAME VARCHAR(64)
		DECLARE @EXW_SERIAL VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE @PROJECT_ID BIGINT
		SET @COMPON_SERIAL = ?
		SET @DIMENSIONS = ?
		SET @COMPON_GENERIC_NAME = ?
		SET @COMPON_SPECIFIC_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		SET @PROJECT_ID = ?
		SET @EXW_SERIAL = ?
		;WITH QUERY AS (
			SELECT C.COMPON_ID componId  , CSS.EXW_SERIAL exwSerial,C.COMPON_SERIAL componSerial,PC.COUNTS freeCounts, C.DIMENSIONS dimensions, CG.VALUE componGenericName, CS.VALUE componSpecificName, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			  FROM T_PROJECT_COMPON PC
			  LEFT JOIN T_COMPONENT C ON C.COMPON_ID = PC.COMPON_ID
			  LEFT JOIN BM_COMPONENT_GENERIC CG ON CG.CODE = C.COMPON_GENERIC
			  LEFT JOIN BM_COMPONENT_SPECIFIC CS ON CS.CODE = C.COMPON_SPECIFIC
			  LEFT JOIN T_EQUIPMENT CSS ON CSS.EQUIP_ID=C.EQUIP_ID
			  WHERE (CHARINDEX((CASE WHEN @COMPON_SERIAL IS NULL THEN C.COMPON_SERIAL ELSE @COMPON_SERIAL END), C.COMPON_SERIAL) > 0
			     OR CHARINDEX((CASE WHEN @DIMENSIONS IS NULL THEN C.DIMENSIONS ELSE @DIMENSIONS END), C.DIMENSIONS) > 0
			      OR CHARINDEX((CASE WHEN @EXW_SERIAL IS NULL THEN CSS.EXW_SERIAL ELSE @EXW_SERIAL END), CSS.EXW_SERIAL) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_GENERIC_NAME IS NULL THEN CG.VALUE ELSE @COMPON_GENERIC_NAME END), CG.VALUE) > 0
			     OR CHARINDEX((CASE WHEN @COMPON_SPECIFIC_NAME IS NULL THEN CS.VALUE ELSE @COMPON_SPECIFIC_NAME END), CS.VALUE) > 0)
			     AND C.DEL_FLAG = '1' AND PC.COUNTS <> 0
			     AND PC.STATUS = '0'
			     AND (@PROJECT_ID IS NULL OR @PROJECT_ID = '' OR PC.PROJECT_ID = @PROJECT_ID)
		) SELECT
			componId,
			componSerial,
			SUM(freeCounts) consumeCounts,
			dimensions,
			componGenericName,
			componSpecificName,
			exwSerial
		FROM(
		SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)) A
		GROUP BY componId,componSerial,dimensions,componGenericName,componSpecificName,exwSerial
	]]>
    </select>
	<!-- 车俩列表 -->
    <select id="list_car">
        <![CDATA[
		DECLARE @LICENSE_PLATE VARCHAR(64)
		DECLARE @SEDAN VARCHAR(64)
		DECLARE @PROPERTY_NAME VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		SET @LICENSE_PLATE = ?
		SET @SEDAN = ?
		SET @PROPERTY_NAME = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		;WITH QUERY AS (
			SELECT top(@PAGE_SIZE) C.CAR_ID carId  , C.LICENSE_PLATE licensePlate, C.SEDAN sedan, C.PROPERTY_NAME propertyName,C.DRIVER_PHONE driverPhone, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			  FROM T_CAR C
			  WHERE (CHARINDEX((CASE WHEN @LICENSE_PLATE IS NULL THEN C.LICENSE_PLATE ELSE @LICENSE_PLATE END), C.LICENSE_PLATE) > 0
			     OR CHARINDEX((CASE WHEN @SEDAN IS NULL THEN C.SEDAN ELSE @SEDAN END), C.SEDAN) > 0
				 OR CHARINDEX((CASE WHEN @PROPERTY_NAME IS NULL THEN C.PROPERTY_NAME ELSE @PROPERTY_NAME END), C.PROPERTY_NAME) > 0)
				 AND C.STATUS = '1'
			     AND C.DEL_FLAG = '1'
		) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY carId DESC
        ]]>
    </select>
	<!-- 装车物流列表 -->
	<select id="list_logistics">
		<![CDATA[
		DECLARE @KEYWORD VARCHAR(64)
		DECLARE @DELIVERY_MAN VARCHAR(64)
		DECLARE @LICENSE_PLATE VARCHAR(64)
		DECLARE @SEND_WAREHOUSE_NAME VARCHAR(64)
		DECLARE @RECEIVE_WAREHOUSE_NAME VARCHAR(64)
		DECLARE @SUMMARY VARCHAR(64)
		DECLARE @STATUS VARCHAR(64)
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE @EQUIP_SERIAL VARCHAR(64)
		SET @KEYWORD = ?
		SET @STATUS = ?
		SET @START = ?
		SET @PAGE_SIZE = ?
		SET @DELIVERY_MAN = @KEYWORD
		SET @SEND_WAREHOUSE_NAME = @KEYWORD
		SET @RECEIVE_WAREHOUSE_NAME = @KEYWORD
		SET @LICENSE_PLATE = @KEYWORD
		SET @SUMMARY = @KEYWORD
	    ;WITH QUERY AS (
			SELECT L.LOGI_ID logiId  ,ADED.EQUIP_ID,L.DISID disId,L.DELIVERY_DATE deliveryDate, L.DELIVERY_MAN deliveryMan, L.SEND_WAREHOUSE_NAME sendWarehouseName,L.RECEIVE_WAREHOUSE_NAME receiveWarehouseName, L.PROPERTY_NAME propertyName,L.SUMMARY summary,L.STATUS status,L.LICENSE_PLATE licensePlate, ROW_NUMBER() OVER (ORDER BY L.LOGI_ID DESC) AS _ROWNUM
			  FROM T_APP_LOGISTICS L
			  LEFT JOIN T_APP_DISPATCH_EQUIP_DETAIL ADED ON ADED.DISID = L.DISID
			  WHERE (CHARINDEX((CASE WHEN @DELIVERY_MAN IS NULL THEN L.DELIVERY_MAN ELSE @DELIVERY_MAN END), L.DELIVERY_MAN) > 0
			     OR CHARINDEX((CASE WHEN @SEND_WAREHOUSE_NAME IS NULL THEN L.SEND_WAREHOUSE_NAME ELSE @SEND_WAREHOUSE_NAME END), L.SEND_WAREHOUSE_NAME) > 0
				 OR CHARINDEX((CASE WHEN @RECEIVE_WAREHOUSE_NAME IS NULL THEN L.RECEIVE_WAREHOUSE_NAME ELSE @RECEIVE_WAREHOUSE_NAME END), L.RECEIVE_WAREHOUSE_NAME) > 0
				 OR CHARINDEX((CASE WHEN @LICENSE_PLATE IS NULL THEN L.LICENSE_PLATE ELSE @LICENSE_PLATE END), L.LICENSE_PLATE) > 0
				 OR L.SUMMARY LIKE '%'+@SUMMARY+'%')
				 AND CHARINDEX((CASE WHEN @STATUS IS NULL THEN L.STATUS ELSE @STATUS END), L.STATUS) > 0
		) SELECT Q.*,E.EQUIP_SERIAL AS equipSerial FROM QUERY Q LEFT JOIN T_EQUIPMENT E ON Q.EQUIP_ID = E.EQUIP_ID 
		WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE) ORDER BY _ROWNUM
        ]]>
	</select>
	<!-- 当前设备各状态数量统计 -->
	<select id="equip_count">
	<![CDATA[
		Select INUSE=(COUNT(case when((BUSINESS_STATUS >= '3' or BUSINESS_STATUS <='6') AND (STATUS =0 or STATUS=8 or STATUS =9)) then '1' end))
		,NOTINUSE=(COUNT(case when(BUSINESS_STATUS ='0'  AND STATUS =1) then '2' end))
		,BROKEN=(COUNT(case when(BUSINESS_STATUS='7' or BUSINESS_STATUS ='9' or STATUS =4) then '3' end)) 
		,OUT=(COUNT(case when(BUSINESS_STATUS ='2' AND STATUS =1) then '4' end))
		,SCRAP= (COUNT(case when(STATUS =6) then '1' end))
		from T_EQUIPMENT t where DEL_FLAG = 1
	]]>
	</select>
	<!-- 查看指定状态的设备 -->
<!-- 	<select id="list_equip_on_status">
		<![CDATA[
		DECLARE @BUSINESS_STATUS VARCHAR(128)
		DECLARE @BUSINESS_STATUS1 VARCHAR(128)
		SET @BUSINESS_STATUS = ?
		SET @BUSINESS_STATUS1 = ?
		 Select D.* from T_EQUIPMENT D where D.DEL_FLAG = 1  
		 and ((CHARINDEX((CASE WHEN @BUSINESS_STATUS IS NULL THEN D.BUSINESS_STATUS ELSE @BUSINESS_STATUS END), D.BUSINESS_STATUS) > 0 
		 or CHARINDEX((CASE WHEN @BUSINESS_STATUS1 IS NULL THEN D.BUSINESS_STATUS ELSE @BUSINESS_STATUS1 END), D.BUSINESS_STATUS) > 0)) 
        ]]>
	</select> -->
	<!-- 结算详情 -->
	<select id="list_settle_contract">
	<![CDATA[
		DECLARE @PROJECT_ID  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        SET @PROJECT_ID =?
        SET @START =?
        SET @PAGE_SIZE = ?  	
             ;WITH QUERY AS (
			SELECT SUM(T.SETTLE_AMOUNT) totalAmout,
			SUM(T.BALANCE_AMOUNT) totalFinishAmount,
			SUM(T.FINISHED_AMOUNT) totalBalanceAmount,
			T.BALANCE_AMOUNT balanceAmount,T.FINISHED_AMOUNT finishAmount,T.SETTLE_AMOUNT settleAmout, T.CONTRACT_SERIAL contractSerial,
			T.PA_ENT_NAME paEntName,T.START_SETTLE_DATE startDate,T.END_SETTLE_DATE endDate,
			ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			 FROM T_SETTLE_CONTRACT T 
			 WHERE PROJECT_ID = @PROJECT_ID  AND T.DEL_FLAG = 1 GROUP BY 
			 T.SETTLE_AMOUNT,T.FINISHED_AMOUNT,T.BALANCE_AMOUNT,T.BALANCE_AMOUNT,T.FINISHED_AMOUNT,T.SETTLE_AMOUNT,T.CONTRACT_SERIAL ,
			 T.PA_ENT_NAME,T.START_SETTLE_DATE,T.END_SETTLE_DATE
			 )SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!--消息统计 -->
	<select id="message_count">
	<![CDATA[
		SELECT COUNT(*) COUNTS from T_BUSINESS_MESSAGE T where READ_FLAG = 0 AND MSG_TYPE='1' and RECEIVE_TEL = ?
	]]>
	</select>
	<select id="remote_repair">
	<![CDATA[
		Select * FROM T_ELEVATOR_MONITOR WHERE EQUIPMENT_STATUS = ?
	]]>
	</select>
	<!-- 项目资产-配件 -->
	<select id="query_comp">
	<![CDATA[
		DECLARE @PROJECT_ID  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
         SET @PROJECT_ID = ?
        SET @START = ?
        SET @PAGE_SIZE = ?
   	     ;WITH QUERY AS (
		 SELECT T.STATUS status,T.COUNTS counts, _BG.VALUE componGeneric, _BC.VALUE componSpecific
		 , ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM T_PROJECT_COMPON T, T_COMPONENT C
		LEFT JOIN BM_COMPONENT_GENERIC _BG ON _BG.CODE = C.COMPON_GENERIC
		LEFT JOIN BM_COMPONENT_SPECIFIC _BC ON _BC.CODE = C.COMPON_SPECIFIC
		WHERE C.COMPON_ID = T.COMPON_ID
		AND T.PROJECT_ID = @PROJECT_ID
		AND T.COUNTS>0
		)SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 维修次数-->
	<select id="list_repair_counts">
	<![CDATA[
		 DECLARE @PROJECT_ID  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        SET @PROJECT_ID = ?
        SET @START = ?
        SET @PAGE_SIZE =?
   	     ;WITH QUERY AS (
		SELECT REPAIR_ID AS repairId, REPAIR_SERIAL AS repairSerial, PROJECT_ID AS projectId, EQUIP_ID AS equipId, PHENOMENON AS phenomenon
		, REPAIR_MAN AS repairMan, REPAIR_AMOUNT AS repairAmount, REPAIR_RESULT AS repairResult, STATUS AS status, USER_ID AS userId
		, USER_NAME AS userName, DEP_ID AS depId, PROVIDED_DATE AS providedDate, APPLYFOR_STATE AS applyforState
		 , ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM T_EQUIPMENT_REPAIR
		WHERE PROJECT_ID =  @PROJECT_ID)SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	<!-- 首页统计-->
	<select id="list_all_counts">
	<![CDATA[
		DECLARE @STATE VARCHAR(128)
		DECLARE @EQUIPMENT_STATUS VARCHAR(128)
		DECLARE @STATUS VARCHAR(128)
		DECLARE @RECEIVE_TEL VARCHAR(128)
		SET @STATE = ?
		SET  @EQUIPMENT_STATUS = ?
		SET @STATUS = ?
		SET @RECEIVE_TEL = ?
			select  top 1 (select COUNT(*)   from T_APP_REPAIR WHERE STATE = @STATE ) as countRepair,
		(select COUNT(*)  from T_ELEVATOR_MONITOR WHERE EQUIPMENT_STATUS = @EQUIPMENT_STATUS )  as countRemoteRepair, 
		(SELECT COUNT(*) FROM T_BUSINESS_MESSAGE WHERE READ_FLAG = '0' AND MSG_TYPE='0' AND RECEIVE_TEL = @RECEIVE_TEL) as countToDo ,
		(select COUNT(*)  from T_PROJECT P WHERE
			 P.DEL_FLAG = 1
			AND P.STATUS=3
		) as projectInUse from T_PROJECT 
	]]>
	</select>
	
	<!-- 查看指定状态的设备 -->
	
	<!-- 查询闲置在仓设备详情-->
	<select id="list_equip_notinuse_detail">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE @BUSINESS_STATUS VARCHAR(128)
		SET @START = ?
        SET @PAGE_SIZE = ?
        SET @BUSINESS_STATUS =?
        ;WITH QUERY AS (
		SELECT _ACTIVATE.ACTIVATE_DATE AS activateDate, _PROJ.PROJECT_ID AS projectId,_PROJ.PROJECT_NAME AS projectName, _EQUIP.BUILDING_NUM AS				
		buildingNum, _EQUIP.EXW_SERIAL AS exwSerial, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			,_BS.VALUE AS specification,BM.VALUE equipGeneric,  _EQUIP.RECORD_ID AS recordId,_EQUIP.EQUIP_VENDER proName,
			_EQUIP.BRACHIUM brachium,_EQUIP.EQUIP_ID equipId
			FROM T_EQUIPMENT_ACTIVATE _ACTIVATE
			FULL JOIN  T_EQUIPMENT_FLOW _FLOW ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID
			FULL JOIN  T_EQUIPMENT _EQUIP ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			FULL JOIN T_PROJECT _PROJ ON _EQUIP.PROJECT_ID = _PROJ.PROJECT_ID
			LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC 
			LEFT JOIN BM_EQUIP_SPECIFIC _BS ON _BS.CODE = _EQUIP.EQUIP_SPECIFIC
			WHERE _EQUIP.BUSINESS_STATUS = @BUSINESS_STATUS  AND _EQUIP.DEL_FLAG =1 AND _EQUIP.STATUS = 1) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)				]]>
	</select>
	<!-- 查询出仓未启用设备详情-->
	<select id="list_equip_out_detail">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE @BUSINESS_STATUS VARCHAR(128)
		SET @START = ?
        SET @PAGE_SIZE = ?
        SET @BUSINESS_STATUS =?
		;WITH QUERY AS (
			SELECT _ACTIVATE.ACTIVATE_DATE AS activateDate,_PROJ.PROJECT_ID AS projectId, _PROJ.PROJECT_NAME AS projectName,
			 _EQUIP.BUILDING_NUM AS buildingNum, _EQUIP.EXW_SERIAL AS exwSerial
			, _EQUIP.RECORD_ID AS recordId,_BS.VALUE AS specification,BM.VALUE equipGeneric,  ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM T_EQUIPMENT_ACTIVATE _ACTIVATE
			FULL JOIN  T_EQUIPMENT_FLOW _FLOW ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID
			FULL JOIN  T_EQUIPMENT _EQUIP ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			FULL JOIN T_PROJECT _PROJ ON _EQUIP.PROJECT_ID = _PROJ.PROJECT_ID
			LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC 
			LEFT JOIN BM_EQUIP_SPECIFIC _BS ON _BS.CODE = _EQUIP.EQUIP_SPECIFIC
			WHERE  _EQUIP.BUSINESS_STATUS ='2' AND _EQUIP.DEL_FLAG =1 AND _EQUIP.STATUS = 1) 
			SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)	
			]]>
	</select>
	<!-- 查询报停未入仓设备详情-->
	<select id="list_equip_broke_detail">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE @BUSINESS_STATUS VARCHAR(128)
		SET @START = ?
        SET @PAGE_SIZE = ?
        SET @BUSINESS_STATUS =?
		;WITH QUERY AS (
			SELECT _ACTIVATE.ACTIVATE_DATE AS activateDate,_PROJ.PROJECT_ID AS projectId, _PROJ.PROJECT_NAME AS projectName,
			 _EQUIP.BUILDING_NUM AS buildingNum, _EQUIP.EXW_SERIAL AS exwSerial
			, _EQUIP.RECORD_ID AS recordId,_BS.VALUE AS specification,BM.VALUE equipGeneric, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM  T_EQUIPMENT_ACTIVATE _ACTIVATE
			FULL JOIN  T_EQUIPMENT_FLOW _FLOW ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID
				FULL JOIN  T_EQUIPMENT _EQUIP ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
				FULL JOIN T_PROJECT _PROJ ON _EQUIP.PROJECT_ID = _PROJ.PROJECT_ID
				LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC 
				LEFT JOIN BM_EQUIP_SPECIFIC _BS ON _BS.CODE = _EQUIP.EQUIP_SPECIFIC
			WHERE (_EQUIP.BUSINESS_STATUS = @BUSINESS_STATUS OR _EQUIP.BUSINESS_STATUS='9' OR _EQUIP.STATUS = 4) AND _EQUIP.DEL_FLAG=1) 
			SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)	
			]]>
	</select>
	<!-- 查看项目对应设备信息-->
	<select id="list_equip_on_project_id">
	<![CDATA[
		DECLARE @PROJECT_ID  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @PROJECT_ID =?
   	      ;WITH QUERY AS (
		SELECT _EQUIP.EQUIP_ID equipId,_EQUIP.BUILDING_NUM buildingNum,
			_DE.INSTALL_HEIGHT installHeight,BM.VALUE equpGeneric
			,_ACTIVATE.ACTIVATE_DATE activateDate,_EQUIP.EXW_SERIAL exwSerial,_EQUIP.EQUIP_VENDER proName,_EQUIP.RECORD_ID recordId,
			BS.VALUE equipSpecific,_DE.BRACHIUM brachium, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			 FROM T_EQUIPMENT _EQUIP
			 LEFT JOIN T_EQUIPMENT_FLOW _FLOW ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			 LEFT JOIN T_EQUIPMENT_ACTIVATE _ACTIVATE ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID 
			 LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC
			 LEFT JOIN BM_EQUIP_SPECIFIC BS ON BS.CODE = _EQUIP.EQUIP_SPECIFIC
			 LEFT JOIN T_PROJECT _PROJ ON _PROJ.PROJECT_ID = _EQUIP.PROJECT_ID AND _PROJ.STATUS = 2 AND _PROJ.DEL_FLAG = 1
			 LEFT JOIN T_EQUIPMENT_INSTALL _DE ON _DE.FLOW_ID =  _EQUIP.FLOW_ID 
			WHERE
			 _EQUIP.PROJECT_ID = @PROJECT_ID
			AND _EQUIP.DEL_FLAG = 1)SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)				
	]]>
	</select>
	<!-- 查看项目详情-头部统计信息-->
	<select id="list_head_info_on_project_id">
	<![CDATA[
		DECLARE @PROJECT_ID  VARCHAR(24)
		SET @PROJECT_ID =?
			SELECT A.totalAmout,B.repairCount FROM ( SELECT SUM(T.SETTLE_AMOUNT) totalAmout FROM T_SETTLE_CONTRACT T WHERE PROJECT_ID =  @PROJECT_ID AND T.DEL_FLAG =1) A ,
			(SELECT  COUNT(*) repairCount FROM T_EQUIPMENT_REPAIR WHERE PROJECT_ID = @PROJECT_ID ) B  
	]]>
	</select>
		
	<!-- 查看项目对应设备-安全信息-->
	<select id="list_secure_on_equip_id">
	<![CDATA[
	   DECLARE @@EQUIP_ID  VARCHAR(24)
 		DECLARE @PROJECT_ID VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
   	    SET @@EQUIP_ID =?
   	    SET @PROJECT_ID = ?
   	    SET @START = ?
   	     SET @PAGE_SIZE =?
	    ;WITH QUERY AS (
	      SELECT
			CONVERT(CHAR(10),A.inspectDate,23) inspectDate,inspectId,inspectPepoles,inspectResult,exwserial,buildingnum,recordId,
			inspectResultName,statusName,remark,longitude,latitude,projectName,rectification,relateModule
			, ROW_NUMBER() OVER (ORDER BY A.inspectDate DESC) AS _ROWNUM
	        FROM (SELECT EI.INSPECT_DATE     inspectDate,
	                     EI.INSPECT_ID        inspectId,
	                     EI.INSPECT_SERIAL    inspectSerial,
	                     EI.INSPECT_PEPOLES   inspectPepoles,
	                     EI.INSPECT_RESULT    inspectResult,
	                     EI.EXW_SERIAL        exwserial,
	                     EI.BUILDING_NUM      buildingnum,
	                     EI.RECORD_ID         recordId,
	                     B.VALUE              inspectResultName,
	                     EI.STATUS            statusName,
	                     EI.REMARK            remark,
	                     EI.LONGITUDE         longitude,
	                     EI.LATITUDE          latitude,
	                     ED.PROJECT_NAME      projectName,
						 EI.RECTIFICATION     rectification,
	                     'EQUIP_INSPECT'      relateModule
	                FROM T_EQUIPMENT_INSPECT EI LEFT JOIN BM_INSPECT_RESULT B ON B.CODE = EI.INSPECT_RESULT, T_EQUIPMENT_INSPECT_SCHEMA EIS, T_EQUIPMENT_DIARY ED
	               WHERE ED.EQUIP_DIARY_ID = EIS.EQUIP_DIARY_ID
	                 AND EIS.INSPECT_SCHEMA_ID = EI.INSPECT_SCHEMA_ID
	                  AND ED.EQUIP_ID = @@EQUIP_ID
	                  AND ED.PROJECT_ID = @PROJECT_ID
	              UNION ALL
	              SELECT IM.INSPECT_DATE     inspectDate,
	                     IM.INSPECT_ID        inspectId,
	                     NULL                 inspectSerial,
	                     IM.INSPECT_PEPOLES   inspectPepoles,
	                     IM.INSPECT_RESULT    inspectResult,
	                     IM.EXW_SERIAL        exwserial,
	                     IM.BUILDING_NUM      buildingnum,
	                     IM.RECORD_ID         recordId,
	                     B.VALUE              inspectResultName,
	                     NULL                 statusName,
	                     IM.REMARK            remark,
	                     IM.LONGITUDE         longitude,
	                     IM.LATITUDE          latitude,
	                     IM.PROJECT_NAME      projectName,
						 IM.RECTIFICATION     rectification,
	                     'INSPECT_MANAGE'     relateModule
	                FROM T_INSPECT_MANAGE IM LEFT JOIN BM_INSPECT_RESULT B ON B.CODE = IM.INSPECT_RESULT
	                WHERE IM.PROJECT_ID = @PROJECT_ID
	              ) A
	    )SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)  ORDER BY inspectDate desc
		
	]]>
	</select>
	<!-- 远程故障设备-->
	<select id="list_remote_repair">
	<![CDATA[
 		DECLARE @EQUIPMENT_STATUS  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
   	    SET @EQUIPMENT_STATUS =?
   	    SET @START = ?
   	     SET @PAGE_SIZE =?
	    ;WITH QUERY AS (
	    SELECT  top(@PAGE_SIZE)repid, monitorAddress, equipmentNumber, equipmentStatus,fault,createByname,faultCurrent, breakdownVoltage, failureFrequency, weightOfFailure, faultFloor,
		 inputVoltage,position,hours, minutes, createDateTime, monitorId, switchFault1,switchFault2, switchFault3, 
		 equipId, exwSerial, equipSpecific, projectName,recordSerial, buildingNum ,ROW_NUMBER() OVER (ORDER BY createDateTime DESC) AS _ROWNUM
	     FROM(
		SELECT  
				null repid,
				T.MONITOR_ADDRESS monitorAddress,
				T.EQUIPMENT_NUMBER equipmentNumber,
				T.EQUIPMENT_STATUS equipmentStatus,
				BF.VALUE fault,
				null createByname,
				T.FAULT_CURRENT faultCurrent,
				T.BREAKDOWN_VOLTAGE breakdownVoltage,
				T.FAILURE_FREQUENCY failureFrequency,
				T.WEIGHT_OF_FAILURE weightOfFailure,
				T.FAULT_FLOOR faultFloor,
				T.INPUT_VOLTAGE inputVoltage,
				T.POSITION position,
				T.HOURS hours,
				T.MINUTES minutes,
				T.CREATE_DATE_TIME createDateTime,
				T.MONITOR_ID monitorId,
				T.SWITCH_FAULT_1 switchFault1,
				T.SWITCH_FAULT_2 switchFault2,
				T.SWITCH_FAULT_3 switchFault3, 
				TE.EQUIP_ID equipId,
				TE.EXW_SERIAL exwSerial,
				TE.EQUIP_SPECIFIC equipSpecific,
				TE.PROJECT_NAME projectName,
				TE.RECORD_ID recordSerial,
				TE.BUILDING_NUM buildingNum 
		FROM T_ELEVATOR_MONITOR T 
		LEFT JOIN T_EQUIPMENT TE ON TE.MONITOR_SERIAL = T.EQUIPMENT_NUMBER  
		AND (
			TE.PROJECT_ID IS NULL
			OR 
			TE.PROJECT_ID = 0
		)
		LEFT JOIN BM_REPAIR_FAULT  BF ON T.FAULT = BF.CODE 
		UNION ALL
		SELECT  
				TR.REPID repid,  
				null monitorAddress,
				null equipmentNumber,
				null equipmentStatus,
				TR.FAULT_DESC fault,
				AU.FULLNAME createByname,
				TR.FAULT_LEVEL faultCurrent,
				TR.BREAK_DOWN_VOLTAGE breakdownVoltage,
				null failureFrequency,
				TR.WEIGHT_OF_FAILURE weightOfFailure,
				null faultFloor,
				TR.IMPUT_VOLTAGE inputVoltage,
				TR.LOCATION position,
				null hours,
				null minutes,
				TR.CREATE_DT createDateTime,
				null monitorId,
				TR.SWITCH_FAULT_1 switchFault1,
				TR.SWITCH_FAULT_2 switchFault2,
				TR.SWITCH_FAULT_3 switchFault3,
				TR.EQUIP_ID equipId,
				TR.EXW_SERIAL exwSerial,
				TR.EQUIPSPEC equipSpecific,
				TR.PROJ_NAME projectName,
				TR.RECORD_SERIAL recordSerial,
				TR.BUILDING_NUM buildingNum
 	FROM T_APP_REPAIR TR 
 	LEFT JOIN APP_USER AU ON AU.USERID = TR.CREATE_BY
 	 where TR.STATE = 1
 	 	AND (
 	 	TR.PROJECT_ID IS NULL
 	 	OR
 	 	TR.PROJECT_ID=0	 	
 	 ) ) as woi)
	SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)  ORDER BY createDateTime DESC
	]]>
	</select>
	<!-- 查看部门-->
	<select id="list_department">
	<![CDATA[
		SELECT T.DEP_ID depId,T.DEP_NAME depName FROM DEPARTMENT T WHERE DELFLAG = 1
	]]>
	</select>
	<!-- 查找指定用户APPUSER -->
	<select id="list_app_user">
	<![CDATA[
		SELECT TOP 1 PASSWORD,USERNAME,MOBILE FROM APP_USER WHERE MOBILE = ? AND DELFLAG = 0
	]]>
	</select>
	
		<!-- 查询配件所在的仓库名称-->
	<select id="list_component_store">
	<![CDATA[	
		SELECT c.CONSUME_COUNTS,s.STORE_NAME  FROM T_COMPONENT c LEFT JOIN T_STORE_HOUSE s ON 
		c.TASK_ID=s.TASK_ID
		WHERE s.TASK_ID=?
		]]>
	</select>
	<!-- 查询在用设备详情-->
	<select id="list_equip_online_detail">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE @BUSINESS_STATUS VARCHAR(128)
		SET @START = ?
        SET @PAGE_SIZE = ?
        SET @BUSINESS_STATUS =?
        ;WITH QUERY AS (
		SELECT _ACTIVATE.ACTIVATE_DATE AS activateDate, _PROJ.PROJECT_ID AS projectId,_PROJ.PROJECT_NAME AS projectName, _EQUIP.BUILDING_NUM AS				
		buildingNum, _EQUIP.EXW_SERIAL AS exwSerial, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			,_BS.VALUE AS specification,BM.VALUE equipGeneric,  _EQUIP.RECORD_ID AS recordId,_EQUIP.EQUIP_VENDER proName,
			_EQUIP.BRACHIUM brachium,_EQUIP.EQUIP_ID equipId
			FROM T_EQUIPMENT_ACTIVATE _ACTIVATE
			FULL JOIN  T_EQUIPMENT_FLOW _FLOW ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID
			FULL JOIN  T_EQUIPMENT _EQUIP ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			FULL JOIN T_PROJECT _PROJ ON _EQUIP.PROJECT_ID = _PROJ.PROJECT_ID
			LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC 
			LEFT JOIN BM_EQUIP_SPECIFIC _BS ON _BS.CODE = _EQUIP.EQUIP_SPECIFIC
			WHERE ( _EQUIP.BUSINESS_STATUS >= '3' AND _EQUIP.BUSINESS_STATUS <= @BUSINESS_STATUS)  AND _EQUIP.DEL_FLAG =1 AND (_EQUIP.STATUS = 0 OR _EQUIP.STATUS=8 OR _EQUIP.STATUS=9)) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)				
		]]>
	</select>
	<!-- 查询报废设备详情-->
	<select id="list_scrap_equip_detail">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
		SET @START = ?
        SET @PAGE_SIZE = ?
        ;WITH QUERY AS (
		SELECT _ACTIVATE.ACTIVATE_DATE AS activateDate, _PROJ.PROJECT_ID AS projectId,_PROJ.PROJECT_NAME AS projectName, _EQUIP.BUILDING_NUM AS				
		buildingNum, _EQUIP.EXW_SERIAL AS exwSerial, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			,_BS.VALUE AS specification,BM.VALUE equipGeneric,  _EQUIP.RECORD_ID AS recordId,_EQUIP.EQUIP_VENDER proName,
			_EQUIP.BRACHIUM brachium,_EQUIP.EQUIP_ID equipId
			FROM T_EQUIPMENT_ACTIVATE _ACTIVATE
			FULL JOIN  T_EQUIPMENT_FLOW _FLOW ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID
			FULL JOIN  T_EQUIPMENT _EQUIP ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			FULL JOIN T_PROJECT _PROJ ON _EQUIP.PROJECT_ID = _PROJ.PROJECT_ID
			LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC 
			LEFT JOIN BM_EQUIP_SPECIFIC _BS ON _BS.CODE = _EQUIP.EQUIP_SPECIFIC
			WHERE _EQUIP.DEL_FLAG =1 AND _EQUIP.STATUS = 6) SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)				]]>
	</select>
	<!--0：所有设备 1：自有设备  2：外租设备-->
	<select id="equip_list">
	<![CDATA[
		DECLARE @type INT
		DECLARE @keyword VARCHAR(128)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
		SET @START = ?
        SET @PAGE_SIZE = ?
		SET @type = ?
		SET @keyword = ?
    ;WITH QUERY AS (
		SELECT 
		ROW_NUMBER() OVER (ORDER BY T.EQUIP_ID) AS _ROWNUM,
		T.EQUIP_ID AS 'equipId',
		EG.VALUE AS 'equipGenericName',    --设备名称
		T.EXW_SERIAL AS 'exwSerial',    --出厂编号
		T.RECORD_ID AS 'recordId',    --备案编号
		T.RECORD_SERIAL AS 'recordSerial',    --设备编号
		ES.VALUE AS 'equipSpecificName',    --规格型号
		T.PROJECT_NAME AS 'projectName',    --项目名称
		T.PROPERTY_NAME AS 'propertyName'  --产权单位
		FROM T_EQUIPMENT T  
		LEFT JOIN BM_EQUIP_SPECIFIC ES ON ES.CODE=T.EQUIP_SPECIFIC 
		LEFT JOIN BM_EQUIP_GENERIC EG ON EG.CODE=T.EQUIP_GENERIC
		WHERE T.EQUIP_ID IN  (
			--所有设备
			SELECT E.EQUIP_ID FROM T_EQUIPMENT E WHERE E.DEL_FLAG='1' AND 
				(E.BUSINESS_STATUS='0' OR E.BUSINESS_STATUS='A' OR E.STATUS='0' OR (E.BUSINESS_STATUS IN('2','3') AND E.STATUS ='9') OR (E.BUSINESS_STATUS='9' AND E.STATUS='1')) AND @type=0
			UNION --自有设备
			SELECT E.EQUIP_ID FROM T_EQUIPMENT E WHERE E.DEL_FLAG='1' AND 
				(E.BUSINESS_STATUS='0' OR E.BUSINESS_STATUS='A' OR E.STATUS='6' OR E.STATUS='0' OR (E.BUSINESS_STATUS='9' OR E.STATUS='1')) AND @type=1
			UNION --外租设备
			SELECT E.EQUIP_ID FROM T_EQUIPMENT E WHERE E.DEL_FLAG='1' AND 
				(E.STATUS='0' OR (E.BUSINESS_STATUS IN('2','3') AND E.STATUS ='9') OR (E.BUSINESS_STATUS='9' AND E.STATUS='1') OR E.STATUS='5') AND @type=2
		) AND (
			@keyword = '' OR @keyword IS NULL OR
		 	ES.VALUE LIKE '%'+@keyword+'%' OR
			T.EXW_SERIAL LIKE '%'+@keyword+'%' OR
			T.PROJECT_NAME LIKE '%'+@keyword+'%' OR
			T.RECORD_SERIAL LIKE '%'+@keyword+'%' 
		) )
		SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
		]]>	
	</select>
	<!-- 查看项目对应设备信息-->
	<select id="list_equip_on_project_id2">
	<![CDATA[
		DECLARE @PROJECT_ID  VARCHAR(24)
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@EQUIP_ID  VARCHAR(24)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @PROJECT_ID =?
   	    SET @EQUIP_ID =?
   	      ;WITH QUERY AS (
		SELECT _EQUIP.EQUIP_ID equipId,_EQUIP.BUILDING_NUM buildingNum,
			_DE.INSTALL_HEIGHT installHeight,BM.VALUE equpGeneric
			,_ACTIVATE.ACTIVATE_DATE activateDate,_EQUIP.EXW_SERIAL exwSerial,_EQUIP.EQUIP_VENDER proName,_EQUIP.RECORD_ID recordId,
			BS.VALUE equipSpecific,_DE.BRACHIUM brachium, ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			 FROM T_EQUIPMENT _EQUIP
			 LEFT JOIN T_EQUIPMENT_FLOW _FLOW ON _EQUIP.FLOW_ID = _FLOW.FLOW_ID
			 LEFT JOIN T_EQUIPMENT_ACTIVATE _ACTIVATE ON _FLOW.ACTIVATE_ID = _ACTIVATE.ACTIVATE_ID 
			 LEFT JOIN BM_EQUIP_GENERIC BM ON BM.CODE = _EQUIP.EQUIP_GENERIC
			 LEFT JOIN BM_EQUIP_SPECIFIC BS ON BS.CODE = _EQUIP.EQUIP_SPECIFIC
			 LEFT JOIN T_PROJECT _PROJ ON _PROJ.PROJECT_ID = _EQUIP.PROJECT_ID AND _PROJ.STATUS = 2 AND _PROJ.DEL_FLAG = 1
			 LEFT JOIN T_EQUIPMENT_INSTALL _DE ON _DE.FLOW_ID =  _EQUIP.FLOW_ID 
			WHERE
			 _EQUIP.PROJECT_ID = @PROJECT_ID
			 AND  _EQUIP.EQUIP_ID=@EQUIP_ID
			AND _EQUIP.DEL_FLAG = 1)SELECT * FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)				
	]]>
	</select>
	
		<!-- 微信现场安装之设备安装列表-->
    <select id="wechat_equip_install_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	      ;WITH QUERY AS (
		SELECT
			BS.VALUE AS equipSpecificName,--设备名称
			BG.VALUE AS equipGenericName,--规格型号
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			E.EQUIP_SERIAL AS equipSerial, --设备自编号
			CL.CONTRACT_ID AS contractId,--合同ID
			D.PROJECT_NAME AS projectName,--项目名称
			DE.DISPATCH_EQUIP_ID AS dispatchEquipId,
			D.PROJECT_ID AS projectId,
			DE.DISPATCH_ID AS dispatchId,
			DE.EQUIP_ID AS equipId
		FROM T_DISPATCH_EQUIP DE
		LEFT JOIN T_DISPATCH D ON DE.DISPATCH_ID = D.DISPATCH_ID
		LEFT JOIN T_EQUIPMENT E ON E.EQUIP_ID = DE.EQUIP_ID
		LEFT JOIN BM_EQUIP_SPECIFIC BS ON E.EQUIP_SPECIFIC = BS.CODE
		LEFT JOIN BM_EQUIP_GENERIC BG ON E.EQUIP_GENERIC = BG.CODE
		LEFT JOIN T_CONTRACT_LEASE CL ON CL.CONTRACT_ID = D.RELATE_ID
		WHERE DE.WORK_STATUS = '0' 
		AND D.DEL_FLAG = '1'
		AND D.APPLYFOR_STATE = '3' 
		AND CL.CONTRACT_ID != ''
		AND D.RELATE_MODULE = 'CONTRACT_LEASE'
		AND ((E.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (E.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (E.EQUIP_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))
		 )
		SELECT  (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)		
	]]>
	</select>
	
			<!-- 微信现场安装之顶升加节列表-->
    <select id="wechat_jackup_section_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	      ;WITH QUERY AS (
		SELECT
			EI.INSTALL_HEIGHT AS installHeight,--安装高度
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			E.EQUIP_SERIAL AS equipSerial, --设备自编号
			ED.PROJECT_NAME AS projectName, --项目名称
			ED.BUILDING_NUM AS buildingNum, --项目楼号
			EI.STARTIN_DATE AS startinDate, --安装开始时间
			EI.APP_INSTALL_STATE AS appInstallState,
			ED.PROJECT_ID AS projectId,
			EI.FLOW_ID AS flowId,
			EI.INSTALL_ID AS installId,
			EF.EQUIP_ID AS equipId,
			EF.CONTRACT_ID AS contractId,
			EF.DISPATCH_EQUIP_ID AS dispatchEquipId,
			ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM T_EQUIPMENT_INSTALL EI 
		LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT E ON EF.EQUIP_ID = E.EQUIP_ID
		LEFT JOIN T_EQUIPMENT_DIARY ED ON EF.EQUIP_DIARY_ID = ED.EQUIP_DIARY_ID
		WHERE EI.APPLYFOR_STATE = '3'  AND EI.DEL_FLAG = '1' AND EI.APP_INSTALL_STATE = '2'
		AND EF.FLOW_STATE = '2'  
		AND ((E.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (E.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (ED.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (ED.BUILDING_NUM LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))
		 )
		SELECT  (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)	
	]]>
	</select>
	
	<!-- 微信现场安装之显示列表列表-->
    <select id="wechat_install_all_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        DECLARE @state  VARCHAR(24)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	    SET @state =?
   	      ;WITH QUERY AS (
		SELECT
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			ED.PROJECT_NAME AS projectName, --项目名称
			ED.BUILDING_NUM AS buildingNum, --项目楼号
			EI.STARTIN_DATE AS startinDate, --安装开始时间
			EI.APP_INSTALL_STATE AS appInstallState,
			ED.PROJECT_ID AS projectId,
			EI.FLOW_ID AS flowId,
			EI.INSTALL_ID AS installId,
			ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM T_EQUIPMENT_INSTALL EI 
		LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT E ON EF.EQUIP_ID = E.EQUIP_ID
		LEFT JOIN T_EQUIPMENT_DIARY ED ON EF.EQUIP_DIARY_ID = ED.EQUIP_DIARY_ID
		WHERE EI.DEL_FLAG = '1'
		AND ((E.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (E.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (ED.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (ED.BUILDING_NUM LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))
		AND (CHARINDEX(','+EI.APP_INSTALL_STATE+',',@state)>0 OR @state = '' OR @state IS NULL)
		 )
		SELECT  (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	
		<!-- 微信现场安装之顶升加节详情-->
    <select id="wechat_jackup_detail">
	<![CDATA[
		DECLARE @INSTALL_ID BIGINT
        SET @INSTALL_ID = ?
   	    SELECT 
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			E.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.PROJECT_NAME AS projectName, --项目名称
			ED.BUILDING_NUM AS buildingNum, --项目楼号
			EI.STARTIN_DATE AS startinDate, --安装开始时间
			EI.ENDIN_DATE AS endinDate, --安装结束时间
			EI.INSTALL_HEIGHT AS installHeight, --安装高度
			ED.PROJECT_ID AS projectId,
			EI.BRACHIUM AS brachium, --臂长
			EI.FIRST_ATTACH AS firstAttach,--附墙数
			EI.FIRST_KNOT_COUNT AS firstKnotCount,--标准节
			EI.EQUIP_AMOUNT AS equipAmount,
			EI.REMARK AS remark, --备注
			EI.CURRENT_INSTALL_HEIGHT AS currentInstallHeight, --当前高度
			EI.INSTALL_LOCATION AS installLocation, --位置
			EI.CHECK_ATTACH AS checkAttach, --自检照片
			EI.FILE_ATTACHES AS fileAttachs, --安装照片
			EI.INSTALL_ID AS installId,
			EI.PARTAKE AS partake
		FROM T_EQUIPMENT_INSTALL EI
		LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT E ON EF.EQUIP_ID = E.EQUIP_ID
		LEFT JOIN T_EQUIPMENT_DIARY ED ON EF.EQUIP_DIARY_ID = ED.EQUIP_DIARY_ID
		WHERE EI.INSTALL_ID = @INSTALL_ID 
	]]>
	</select>
		
	<!-- 微信现场安装之安装整改验收详情-->
    <select id="wechat_install_rectifica_detail">
	<![CDATA[
		DECLARE @INSTALL_ID BIGINT
        SET @INSTALL_ID = ?
   	    SELECT 
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			E.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.PROJECT_NAME AS projectName, --项目名称
			ED.BUILDING_NUM AS buildingNum, --项目楼号
			EI.STARTIN_DATE AS startinDate, --安装开始时间
			EI.ENDIN_DATE AS endinDate, --安装结束时间
			EI.INSTALL_HEIGHT AS installHeight, --安装高度
			ED.PROJECT_ID AS projectId,
			EI.BRACHIUM AS brachium, --臂长
			EI.FIRST_ATTACH AS firstAttach,--附墙数
			EI.FIRST_KNOT_COUNT AS firstKnotCount,--标准节
			EI.EQUIP_AMOUNT AS equipAmount,
			EI.REMARK AS remark, --备注
			EI.CURRENT_INSTALL_HEIGHT AS currentInstallHeight, --当前高度
			EI.INSTALL_LOCATION AS installLocation, --位置
			EI.CHECK_ATTACH AS checkAttach, --自检照片
			EI.FILE_ATTACHES AS fileAttachs, --安装照片
			EI.PARTAKE AS partake,--安装人员
			EI.INSTALL_ID AS installId,
			TT.REVIEW_ID AS reviewId,
			TT.RECTIFICA_IMAGE AS rectificaImage, -- 整改照片
			TT.RECTIFICA_DATE AS rectificaDate, -- 整改日期
			TT.RECTIFICA_DETAIL AS rectificaDetail, -- 整改内容
			TT.REVIW_CHECK_ATTACH AS reviwCheckAttach, --验收照片
			TT.REVIEW_CONCLUSION AS reviewConclusion, --验收结论
			TT.REVIE_STATUS AS revieStatus, --验收结果
			TT.REJECT_REASON AS rejectReason --驳回理由
		FROM T_EQUIPMENT_INSTALL EI
		LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT E ON EF.EQUIP_ID = E.EQUIP_ID
		LEFT JOIN T_EQUIPMENT_DIARY ED ON EF.EQUIP_DIARY_ID = ED.EQUIP_DIARY_ID
		LEFT JOIN (SELECT TOP 1 IR.*,RR.RECTIFICA_IMAGE,RR.RECTIFICA_DATE,RR.RECTIFICA_DETAIL 
		FROM T_INSTALL_REVIEW IR
		LEFT JOIN T_RECTIFICATION_RECORD RR ON IR.REVIEW_ID = RR.REVIEW_ID
		WHERE IR.RELATE_MODULE = 'EQUIP_INSTALL'AND IR.RELATE_ID = @INSTALL_ID
		 ORDER BY IR.REVIEW_ID DESC)TT ON TT.RELATE_ID = EI.INSTALL_ID
		WHERE EI.INSTALL_ID = @INSTALL_ID
	]]>
	</select>
	
	<!-- 微信现场安装之安装完成详情-->
    <select id="wechat_install_pass_detail">
	<![CDATA[
		DECLARE @INSTALL_ID BIGINT
        SET @INSTALL_ID = ?
   	    SELECT 
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			E.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.PROJECT_NAME AS projectName, --项目名称
			ED.BUILDING_NUM AS buildingNum, --项目楼号
			EI.STARTIN_DATE AS startinDate, --安装开始时间
			EI.ENDIN_DATE AS endinDate, --安装结束时间
			ED.PROJECT_ID AS projectId,
			EI.INSTALL_HEIGHT AS installHeight, --安装高度
			EI.BRACHIUM AS brachium, --臂长
			EI.FIRST_ATTACH AS firstAttach,--附墙数
			EI.FIRST_KNOT_COUNT AS firstKnotCount,--标准节
			EI.EQUIP_AMOUNT AS equipAmount,
			EI.REMARK AS remark, --备注
			EI.INSTALL_ID AS installId,
			EI.CURRENT_INSTALL_HEIGHT AS currentInstallHeight, --当前高度
			EI.INSTALL_LOCATION AS installLocation, --位置
			EI.CHECK_ATTACH AS checkAttach, --自检照片
			EI.FILE_ATTACHES AS fileAttachs, --安装照片
			EI.PARTAKE AS partake,--安装人员
			IR.REVIEW_ID AS reviewId,
			IR.REVIW_CHECK_ATTACH AS reviwCheckAttach, --验收照片
			IR.REVIEW_CONCLUSION AS reviewConclusion, --验收结论
			IR.REVIE_STATUS AS revieStatus, --验收结果
			IR.REJECT_REASON AS rejectReason --驳回理由
		FROM T_EQUIPMENT_INSTALL EI 
		LEFT JOIN T_INSTALL_REVIEW IR ON IR.RELATE_ID = EI.INSTALL_ID
		LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT E ON EF.EQUIP_ID = E.EQUIP_ID
		LEFT JOIN T_EQUIPMENT_DIARY ED ON EF.EQUIP_DIARY_ID = ED.EQUIP_DIARY_ID
		WHERE EI.INSTALL_ID = @INSTALL_ID
		AND IR.RELATE_MODULE = 'EQUIP_INSTALL'
	]]>
	</select>
	
	<!-- 微信现场安装之整改记录列表-->
    <select id="wechat_rectifica_check_detail">
	<![CDATA[
		DECLARE @RELATE_ID BIGINT
        SET @RELATE_ID = ?
   	     SELECT
			IR.REVIEW_ID AS reviewId,
			IR.REVIW_CHECK_ATTACH AS reviwCheckAttach,--验收照片
			IR.REVIEW_CONCLUSION AS reviewConclusion,--验收结论
			IR.REVIE_STATUS AS revieStatus,--验收结果
			IR.REJECT_REASON AS rejectReason,--驳回理由
			RR.RECTIFICA_ID AS rectificaId,
			RR.RECTIFICA_IMAGE AS rectificaImage,-- 整改照片
			RR.RECTIFICA_DATE AS rectificaDate,-- 整改日期
			RR.RECTIFICA_DETAIL AS rectificaDetail-- 整改内容
		FROM T_INSTALL_REVIEW IR 
		LEFT JOIN T_RECTIFICATION_RECORD RR ON IR.REVIEW_ID = RR.REVIEW_ID 
		WHERE IR.RELATE_ID = @RELATE_ID
		AND IR.RELATE_MODULE = 'EQUIP_INSTALL'
	]]>
	</select>
	
	<!-- 微信现场安装之正在安装列表-->
    <select id="wechat_equip_installing_list">
	<![CDATA[
		DECLARE @START INT
		DECLARE @PAGE_SIZE INT
		DECLARE	@keyword  VARCHAR(64)
		SET @START = ?
		SET @PAGE_SIZE =?
		SET @keyword =?
		   	;WITH QUERY AS (
			SELECT 
			TS.DISCLOSURE_DATE AS disclosureDate, --交底日期
			E.RECORD_ID AS recordId,--备案编号
			E.EXW_SERIAL AS exwSerial,--出厂编号
			P.PROJECT_NAME AS projectName, --项目名称
			TS.DISCLOSURE_ID AS disclosureId,
			TS.DISPATCH_EQUIP_ID AS dispatchEquipId,
			DE.DISPATCH_ID AS dispatchId,
			TS.EQUIP_ID AS equipId,
			TS.PROJECT_ID AS projectId,
			E.EQUIP_SERIAL AS equipSerial,--设备自编号
			ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM T_TECHNICAL_DISCLOSURE TS 
			LEFT JOIN T_EQUIPMENT E ON TS.EQUIP_ID = E.EQUIP_ID
			LEFT JOIN T_PROJECT P ON TS.PROJECT_ID = P.PROJECT_ID
			LEFT JOIN T_DISPATCH_EQUIP DE ON DE.DISPATCH_EQUIP_ID = TS.DISPATCH_EQUIP_ID 
			WHERE NOT EXISTS
		    (SELECT EI.DISCLOSURE_ID FROM T_EQUIPMENT_INSTALL EI 
			WHERE TS.DISCLOSURE_ID = EI.DISCLOSURE_ID)
			AND TS.RELATE_MODULE = 'EQUIP_INSTALL'
			AND ((E.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (E.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (P.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))
			)
		SELECT  (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	
	<!-- 微信现场拆卸之待拆卸列表-->
	<select id="wechat_wait_dismantle_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	      ;WITH QUERY AS (
   	      	SELECT
				ED.RECORD_ID AS recordId,--备案编号
				ED.EXW_SERIAL AS exwSerial,--出厂编号
				ED.EQUIP_SERIAL AS equipSerial,--设备自编号
				EI.FLOW_ID AS flowId,
				EI.INSTALL_ID AS installId,
				EI.INSTALL_HEIGHT AS installHeight, --安装高度
				EI.BRACHIUM AS brachium, --臂长
				EI.FIRST_ATTACH AS firstAttach,--附墙数
				EI.FIRST_KNOT_COUNT AS firstKnotCount,--标准节
				EI.EQUIP_AMOUNT AS equipAmount,
				EI.REMARK AS remark, --备注
				EI.CURRENT_INSTALL_HEIGHT AS currentInstallHeight, --当前高度
				EI.INSTALL_LOCATION AS installLocation, --位置
				EI.STARTIN_DATE AS startinDate,--安装开始时间
				ED.PROJECT_ID AS projectId,--项目名称
				ED.PROJECT_NAME AS projectName,--项目名称
				ED.BUILDING_NUM AS buildingNum,--楼号
				EF.EQUIP_ID AS equipId,
				EF.CONTRACT_ID AS contractId,
				EF.DISPATCH_EQUIP_ID AS dispatchEquipId,
				ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM T_EQUIPMENT_INSTALL EI
			LEFT JOIN T_EQUIPMENT_FLOW EF ON EI.FLOW_ID = EF.FLOW_ID
			LEFT JOIN T_EQUIPMENT_DIARY ED ON ED.EQUIP_DIARY_ID = EF.EQUIP_DIARY_ID
			WHERE EI.DEL_FLAG = '1' AND EI.APPLYFOR_STATE = '3' AND EI.APP_INSTALL_STATE = '2'
			AND EF.FLOW_STATE = '2'
	   	    AND ((ED.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (ED.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (ED.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))  
		 )
		SELECT  (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)	
	]]>
	</select>
	
		<!-- 微信现场拆卸之显示列表-->
    <select id="wechat_dismantle_all_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        DECLARE @state  VARCHAR(24)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	    SET @state =?
   	      ;WITH QUERY AS (
		SELECT
			EI.RECORD_ID AS recordId,--备案编号
			EI.EXW_SERIAL AS exwSerial,--出厂编号
			EI.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.FLOW_ID AS flowId,
			ED.STARTDIS_DATE AS startdisDate,--拆卸开始时间
			EI.PROJECT_NAME AS projectName,--项目名称
			EI.BUILDING_NUM AS buildingNum,--楼号
			ED.DISMANTLE_ID AS dismantleId,
			ED.APP_DISMANTLE_STATE AS appDismantleState,
			ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
		FROM T_EQUIPMENT_DISMANTLE ED 
		LEFT JOIN T_EQUIPMENT_FLOW EF ON ED.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT_DIARY EI ON EF.EQUIP_DIARY_ID = EI.EQUIP_DIARY_ID
		WHERE ED.DEL_FLAG = '1'
		AND ((EI.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (EI.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (EI.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
		OR (EI.BUILDING_NUM LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))
		AND (CHARINDEX(','+ED.APP_DISMANTLE_STATE+',',@state)>0 OR @state = '' OR @state IS NULL)
		 )
		SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)
	]]>
	</select>
	
		<!-- 微信现场拆卸之整改记录列表-->
    <select id="wechat_dismantle_check_detail">
	<![CDATA[
		DECLARE @RELATE_ID BIGINT
        SET @RELATE_ID = ?
   	     SELECT
			IR.REVIEW_ID AS reviewId,
			IR.REVIW_CHECK_ATTACH AS reviwCheckAttach,--验收照片
			IR.REVIEW_CONCLUSION AS reviewConclusion,--验收结论
			IR.REVIE_STATUS AS revieStatus,--验收结果
			IR.REJECT_REASON AS rejectReason,--驳回理由
			RR.RECTIFICA_ID AS rectificaId,
			RR.RECTIFICA_IMAGE AS rectificaImage,-- 整改照片
			RR.RECTIFICA_DATE AS rectificaDate,-- 整改日期
			RR.RECTIFICA_DETAIL AS rectificaDetail-- 整改内容
		FROM T_INSTALL_REVIEW IR 
		LEFT JOIN T_RECTIFICATION_RECORD RR ON IR.REVIEW_ID = RR.REVIEW_ID 
		WHERE IR.RELATE_ID = @RELATE_ID
		AND IR.RELATE_MODULE = 'EQUIP_DISMANTLE'
	]]>
	</select>
		
	<!-- 微信现场拆卸之拆卸完成详情-->
    <select id="wechat_dismantle_pass_detail">
	<![CDATA[
		DECLARE @DISMANTLE_ID BIGINT
        SET @DISMANTLE_ID = ?
		SELECT
			EI.RECORD_ID AS recordId,--备案编号
			EI.EXW_SERIAL AS exwSerial,--出厂编号
			EI.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.FLOW_ID AS flowId,
			ED.STARTDIS_DATE AS startdisDate,--拆卸开始时间
			ED.ENDDIS_DATE AS enddisDate,--拆卸结束时间
			ED.DISMANTLE_HEIGHT AS dismantleHeight,--拆卸高度
			ED.PARTAKE AS partake,--拆卸人员
			ED.CHECK_ATTACH AS checkAttach, --自检照片
			ED.FILE_ATTACHES AS fileAttachs, --安装照片
			EI.PROJECT_NAME AS projectName,--项目名称
			ED.DISMANTLE_LOCATION AS dismantleLocation,
			ED.CURRENT_INSTALL_HEIGHT AS currentInstallHeight,
			ED.EQUIP_AMOUNT AS equipAmount,
			EI.BUILDING_NUM AS buildingNum,--楼号
			ED.DISMANTLE_ID AS dismantleId,
			IR.REVIW_CHECK_ATTACH AS reviwCheckAttach, --验收照片
			IR.REVIEW_CONCLUSION AS reviewConclusion, --验收结论
			IR.REVIE_STATUS AS revieStatus, --验收结果
			IR.REJECT_REASON AS rejectReason --驳回理由
		FROM T_EQUIPMENT_DISMANTLE ED 
		LEFT JOIN T_EQUIPMENT_FLOW EF ON ED.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT_DIARY EI ON EF.EQUIP_DIARY_ID = EI.EQUIP_DIARY_ID
		LEFT JOIN T_INSTALL_REVIEW IR ON IR.RELATE_ID = ED.DISMANTLE_ID
		WHERE ED.DISMANTLE_ID = @DISMANTLE_ID
		AND IR.RELATE_MODULE = 'EQUIP_DISMANTLE'
	]]>
	</select>
	
	<!-- 微信现场拆卸之拆卸整改验收详情-->
    <select id="wechat_dismantle_rectifica_detail">
	<![CDATA[
		DECLARE @DISMANTLE_ID BIGINT
        SET @DISMANTLE_ID = ?
   	    SELECT 
			EI.RECORD_ID AS recordId,--备案编号
			EI.EXW_SERIAL AS exwSerial,--出厂编号
			EI.EQUIP_SERIAL AS equipSerial,--设备自编号
			ED.FLOW_ID AS flowId,
			ED.STARTDIS_DATE AS startdisDate,--拆卸开始时间
			ED.ENDDIS_DATE AS enddisDate,--拆卸结束时间
			ED.DISMANTLE_HEIGHT AS dismantleHeight,--拆卸高度
			ED.PARTAKE AS partake,--拆卸人员
			ED.EQUIP_AMOUNT AS equipAmount,
			ED.CHECK_ATTACH AS checkAttach, --自检照片
			ED.FILE_ATTACHES AS fileAttachs, --安装照片
			EI.PROJECT_NAME AS projectName,--项目名称
			EI.BUILDING_NUM AS buildingNum,--楼号
			ED.DISMANTLE_ID AS dismantleId,
			ED.DISMANTLE_LOCATION AS dismantleLocation,
			ED.REMARK AS remark,
			TT.REVIEW_ID AS reviewId,
			TT.RECTIFICA_IMAGE AS rectificaImage, -- 整改照片
			TT.RECTIFICA_DATE AS rectificaDate, -- 整改日期
			TT.RECTIFICA_DETAIL AS rectificaDetail, -- 整改内容
			TT.REVIW_CHECK_ATTACH AS reviwCheckAttach, --验收照片
			TT.REVIEW_CONCLUSION AS reviewConclusion, --验收结论
			TT.REVIE_STATUS AS revieStatus, --验收结果
			TT.REJECT_REASON AS rejectReason --驳回理由
		FROM T_EQUIPMENT_DISMANTLE ED 
		LEFT JOIN T_EQUIPMENT_FLOW EF ON ED.FLOW_ID = EF.FLOW_ID
		LEFT JOIN T_EQUIPMENT_DIARY EI ON EF.EQUIP_DIARY_ID = EI.EQUIP_DIARY_ID
		LEFT JOIN (SELECT TOP 1 IR.*,RR.RECTIFICA_IMAGE,RR.RECTIFICA_DATE,RR.RECTIFICA_DETAIL 
		FROM T_INSTALL_REVIEW IR
		LEFT JOIN T_RECTIFICATION_RECORD RR ON IR.REVIEW_ID = RR.REVIEW_ID
		WHERE IR.RELATE_MODULE = 'EQUIP_DISMANTLE' AND IR.RELATE_ID = @DISMANTLE_ID ORDER BY IR.REVIEW_ID DESC)TT ON TT.RELATE_ID = ED.DISMANTLE_ID
		WHERE ED.DISMANTLE_ID = @DISMANTLE_ID
	]]>
	</select>
	
	
		<!-- 微信现场拆卸之拆卸中列表-->
	<select id="wechat_dismantleing_list">
	<![CDATA[
		DECLARE @START INT
        DECLARE @PAGE_SIZE INT
        DECLARE	@keyword  VARCHAR(64)
        SET @START = ?
   	    SET @PAGE_SIZE =?
   	    SET @keyword =?
   	      ;WITH QUERY AS (
			SELECT 
				TS.DISCLOSURE_DATE AS disclosureDate, --交底日期
				TS.DISCLOSURE_ID AS disclosureId,
				TS.DISPATCH_EQUIP_ID AS dispatchEquipId,
				E.RECORD_ID AS recordId,--备案编号
				E.EXW_SERIAL AS exwSerial,--出厂编号
				P.PROJECT_NAME AS projectName, --项目名称
				DE.DISPATCH_ID AS dispatchId,
				TS.PROJECT_ID AS projectId,
				TS.EQUIP_ID AS equipId,
				ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) AS _ROWNUM
			FROM T_TECHNICAL_DISCLOSURE TS 
			LEFT JOIN T_EQUIPMENT E ON TS.EQUIP_ID = E.EQUIP_ID
			LEFT JOIN T_PROJECT P ON TS.PROJECT_ID = P.PROJECT_ID
			LEFT JOIN T_DISPATCH_EQUIP DE ON DE.DISPATCH_EQUIP_ID = TS.DISPATCH_EQUIP_ID 
			WHERE NOT EXISTS (
			SELECT EI.DISCLOSURE_ID FROM T_EQUIPMENT_DISMANTLE EI 
			WHERE TS.DISCLOSURE_ID = EI.DISCLOSURE_ID )
			AND TS.RELATE_MODULE = 'EQUIP_DISMANTLE'
	   	    AND ((E.RECORD_ID LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (E.EXW_SERIAL LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL )
			OR (P.PROJECT_NAME LIKE '%'+@keyword+'%' OR @keyword = '' OR @keyword IS NULL ))  
		 )
		SELECT (SELECT COUNT(*) FROM QUERY) AS 'count',* FROM QUERY WHERE _ROWNUM > @START AND _ROWNUM <= (@START + @PAGE_SIZE)	
	]]>
	</select>
</mapper>


