<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="receive">
	<!-- 合同的累计已收计算 -->
	<select id="contract_amount_receive">
	<![CDATA[
		DECLARE @contractId BIGINT 
		SET @contractId = ? 
		
		SELECT 
			ISNULL(SUM(AR.RECEIVE_AMOUNT),0) AS receiveAmount
		FROM T_AMOUNT_RECEIVE AR
		WHERE CONTRACT_ID IN (
			SELECT 
				DISTINCT CONTRACT_ID 
			FROM T_COMBINE_SETTLE_CONTRACT B 
			WHERE EXISTS(
				SELECT 
					COMBINE_ID 
				FROM T_COMBINE_SETTLE_CONTRACT A 
					WHERE A.CONTRACT_ID = @contractId AND B.SETTLE_ID = A.SETTLE_ID
			)
		)
	]]>
	</select>
	
</mapper>