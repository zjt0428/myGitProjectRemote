package com.knight.emms.domain.impl;

import com.knight.core.util.DateUtil;
import com.knight.emms.dao.EquipInspectSchemaDao;
import com.knight.emms.domain.SchedularInspectDomain;
import com.knight.emms.model.EquipInspect;
import com.knight.emms.model.EquipInspectSchema;
import com.knight.emms.service.EquipInspectSchemaService;

import javax.annotation.Resource;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

/**
 * Created by YaoFly on 2016/10/26.
 */
public class SchedularInspectDomainImpl implements SchedularInspectDomain {
    @Resource
    private EquipInspectSchemaService equipInspectSchemaService;
    @Resource
    private EquipInspectSchemaDao equipInspectSchemaDao;

    @Override
    public void autoCreateWaitEquipInspect() {
        Date planDate = DateUtil.setStartDay(new Date());
        String sql = "SELECT EI FROM EquipInspectSchema EI,EquipFlow EF WHERE EF.flowId = EI.flowId  AND EI.nextFormTime = ? AND EI.delFlag = '1' AND EF.flowState<5";
        List<EquipInspectSchema> list = equipInspectSchemaDao.findByHql(sql,new Object[]{planDate});
        for(EquipInspectSchema co :list){
            equipInspectSchemaService.createWaitEquipInspect(co);
        }
    }

}
